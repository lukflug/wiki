<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" type="text/css" href="../_/stylesheet.css">

        <title>x86 - osdev.wiki</title>
        
        <meta name="keywords" content="osdev-wiki,osdev,programming,x86">
        <meta name="description" content="Introduction to the x86 CPU architecture.">
    </head>
    <body>
        <span id="roothack" href="../"></span>
        <div id="content">
            <svg id="logo" viewBox="0 0 747.13464 126.28621">
                <use href="../_/static/logo.svg#g623"></use>
            </svg>
            <div id="navbar"><ul>
	<li><a href="../">Main page</a></li>
	<li><a href="../categories">Category list</a></li>
	<li><a href="../tags">Tag list</a></li>
</ul>

<div class="stork-wrapper">
	<input data-stork="wiki" placeholder="Search..." />
	<div data-stork="wiki-output"></div>
</div>
<!-- vim: set sw=4 et : -->
</div>
            <div id="padding"></div>
            <div id="toc"><ul class="sectlevel1">
<li><a href="#_history">1. History</a>
<ul class="sectlevel2">
<li><a href="#_first_generation">1.1. First generation</a></li>
<li><a href="#_second_generation">1.2. Second generation</a></li>
<li><a href="#_nec_v20">1.3. NEC V20</a></li>
<li><a href="#_third_generation">1.4. Third generation</a></li>
<li><a href="#_fourth_generation">1.5. Fourth generation</a></li>
<li><a href="#_fifth_generation">1.6. Fifth generation</a></li>
<li><a href="#_cyrix_extensions">1.7. Cyrix extensions</a></li>
<li><a href="#_sixth_generation">1.8. Sixth generation</a></li>
<li><a href="#_seventh_generation">1.9. Seventh generation</a></li>
<li><a href="#_x86_64">1.10. x86-64</a></li>
</ul>
</li>
<li><a href="#_operating_modes">2. Operating modes</a>
<ul class="sectlevel2">
<li><a href="#_real_mode">2.1. Real mode</a></li>
<li><a href="#_protected_mode">2.2. Protected mode</a></li>
<li><a href="#_system_management_mode">2.3. System management mode</a></li>
<li><a href="#_long_mode">2.4. Long mode</a></li>
</ul>
</li>
<li><a href="#_instruction_set_and_execution_model">3. Instruction set and execution model</a>
<ul class="sectlevel2">
<li><a href="#_8086">3.1. 8086</a></li>
<li><a href="#_80186">3.2. 80186</a></li>
<li><a href="#_80286">3.3. 80286</a></li>
<li><a href="#_i386">3.4. i386</a></li>
<li><a href="#_i486">3.5. i486</a></li>
<li><a href="#_i586">3.6. i586</a></li>
<li><a href="#_i686">3.7. i686</a></li>
<li><a href="#_i786">3.8. i786</a></li>
<li><a href="#_x86_64_2">3.9. x86-64</a></li>
</ul>
</li>
<li><a href="#_extensions">4. Extensions</a>
<ul class="sectlevel2">
<li><a href="#_model_specific_registers">4.1. Model-specific registers</a></li>
<li><a href="#_page_size_extensions">4.2. Page size extensions</a></li>
<li><a href="#_virtual_8086_mode_extensions">4.3. Virtual 8086 mode extensions</a></li>
<li><a href="#_debugging_extensions">4.4. Debugging extensions</a></li>
<li><a href="#_pge">4.5. PGE</a></li>
<li><a href="#_pae">4.6. PAE</a></li>
</ul>
</li>
<li><a href="#_floating_point_and_vector_extensions">5. Floating-point and vector extensions</a>
<ul class="sectlevel2">
<li><a href="#_x87">5.1. x87</a></li>
<li><a href="#_mmx">5.2. MMX</a></li>
<li><a href="#_sse">5.3. SSE</a></li>
<li><a href="#_avx">5.4. AVX</a></li>
</ul>
</li>
<li><a href="#_bit_manipulation_extensions">6. Bit manipulation extensions</a>
<ul class="sectlevel2">
<li><a href="#_abm">6.1. ABM</a></li>
<li><a href="#_bmi1">6.2. BMI1</a></li>
<li><a href="#_tbm">6.3. TBM</a></li>
<li><a href="#_bmi2">6.4. BMI2</a></li>
<li><a href="#_adx">6.5. ADX</a></li>
</ul>
</li>
<li><a href="#_external_links">7. External links</a></li>
</ul></div>
<article>
<h1 class="sect0">x86</h1>

<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><strong>x86</strong> is a backwards compatible family of little-endian complex instruction
set architectures introduced in 1978 by Intel.
The two preeminent manufacturers of CPUs implementing x86 are Intel and AMD.
The iterations of the ISA can be broadly classified by integer width:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>16-bit x86, also referred to as <strong>IA-16</strong>, <strong>x86-16</strong>, or <strong>x86_16</strong> (introduced
with the Intel 8086 in 1978).</p>
</li>
<li>
<p>32-bit x86, also referred to as <strong>IA-32</strong>, <strong>x86-32</strong>, or <strong>x86_32</strong> (introduced
with the Intel 386 in 1985).</p>
</li>
<li>
<p>64-bit x86 (not to be confused with IA-64), also referred to as <strong>x86-64</strong>,
<strong>x86_64</strong>, <strong>AMD64</strong>, or <strong>x64</strong>.
It is also referred to as <em>EM64T</em>, <em>IA-32e</em>, or <em>Intel64</em> by Intel.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_history">1. History</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_first_generation">1.1. First generation</h3>
<div class="paragraph">
<p>The first iteration of the x86 architecture was introduced in 1978 with the
<strong>Intel 8086</strong>.
The 8086 is a 16-bit CPU with 16-bit registers, a 16-bit data bus, and a 20-bit
address bus.
Thus, it is able to address one mebibyte of RAM.
Although the 8086 has no binary compatibility with the 8080 or 8085, it is
designed to allow all 8080 or 8085 programs to be machine translated to work on
the 8086.</p>
</div>
<div class="paragraph">
<p>Slightly later, the <strong>Intel 8088</strong> was introduced.
The 8088 is internally identical to the 8086, but had a 8-bit data bus, and was
used by the original IBM PC, introduced in 1981, the predecessor of all modern
PCs.
Thus, the x86 architecture became the dominant architecture on personal
computers.</p>
</div>
<div class="paragraph">
<p>Intel also introduced the <strong>Intel 8087</strong> FPU, which provides floating-point
capabilities, and operates in parallel to the main processor.
The <em>Intel 8089</em> IOP (I/O processor) was also introduced to allow fast I/O
operations without CPU supervision, allowing for an increasing degree of
parallelism.
However, the IBM PC does not use the 8089, instead, using the simpler Intel
8237 (designed for the 8-bit 8085).
Consequently, no successor to the 8089 was ever made.</p>
</div>
</div>
<div class="sect2">
<h3 id="_second_generation">1.2. Second generation</h3>
<div class="paragraph">
<p>In 1982, Intel introduced the <strong>Intel 80186</strong>, <strong>Intel 80188</strong>, and <strong>Intel 80286</strong>
(also known as the 186, 188, and 286 respectively).
The 186 and 188 are similar to the 8086 and 8088 respectively, but are intended
for embedded systems, and integrate peripherals, that are not compatible with
IBM PCs.</p>
</div>
<div class="paragraph">
<p>Although the 8087 is compatible with both the 186 and 187, the <strong>Intel 80187</strong>
(also known as the 187) was introduced much later as a math coprocessor
compatible the 186 (but not the 188).
The 187 is internally more similar to the 387, supports all the 387
instructions, and is IEEE 754 compliant.</p>
</div>
<div class="paragraph">
<p>The 286, however, is intended for multi-user multitasking environments.
Thus, the 286 introduces features for multitasking and memory protection, and
is able to address up to 16 MiBs of RAM.
To preserve compatibility with the 8086, most of the features introduced with
the 286 can only be used in a mode called <em>protected mode</em>.
The 286 and most subsequent x86 processors start in <em>real mode</em>, which emulates
the behavior of a 8086.
The 286 started to gain wide adoption with the introduction of the IBM AT in
1984.</p>
</div>
<div class="paragraph">
<p>The math coprocessor for the 286 is the <strong>Intel 80287</strong> (also known as the 287).
A later version of the 287, known as the 287XL, is internally similar to the
387SX.
The 287 is also compatible with the 386DX and 386SX.</p>
</div>
</div>
<div class="sect2">
<h3 id="_nec_v20">1.3. NEC V20</h3>
<div class="paragraph">
<p>The <strong>NEC V20</strong> is a pin compatible replacement for the 8088, and a very popular
upgrade for XT-class machines, due to being able to execute more instructions
on average in a smaller amount of time.
Variants include the <strong>NEC V30</strong>, which is pin compatible with the 8086, the
<em>NEC V40</em>, which corresponds to the 188, and the <em>NEC V50</em>, which corresponds
to the 186.
The <em>NEC V33</em> and the <em>NEC V53</em> are V30 and V50 variants with performance
equivalent to a 286, that are able to address up to 16 MiB of memory.
The <em>NEC V25</em> and <em>NEC V35</em> are microcontroller variants of the V20 and V30
respectively.
The later V60 series implements a different ISA, but has a V20 emulation mode.</p>
</div>
<div class="paragraph">
<p>All these CPUs support the 186 instruction set and new instructions exclusively
available on NEC CPUs.
Among other things, these instructions include nibble and bitwise operations.
The V25 and V35 implement additional enhancements, such as eight register banks
for interrupt handling.</p>
</div>
<div class="paragraph">
<p>In addition to the enhancements common to all V-series CPUs, the V20, V30, V40,
and V50 feature an <em>8080 emulation mode</em>, whereby 8080 binaries can be executed
without translation.</p>
</div>
<div class="paragraph">
<p>The V33 and V53 implement <em>expanded addressing mode</em>, which allows the use of
up to 16 MiB of RAM.
This mode is essentially real mode with paging of 16 kiB pages.
The 20-bit linear addresses are translated to 24-bit physical addresses with a
table at I/O ports 0xFF00-0xFF7F.</p>
</div>
</div>
<div class="sect2">
<h3 id="_third_generation">1.4. Third generation</h3>
<div class="paragraph">
<p>In 1985, Intel introduced the <strong>Intel 386DX</strong>.
This new iteration introduced support for 32-bit integers and extended
protected mode to introduce, among other things, paging, and support for up to
4 GiBs of RAM.
Later, Intel introduced the <strong>Intel 386SX</strong>, which is internally similar to the
386DX, but has a 16-bit data bus and 24-bit address bus rather than 32-bit
busses.</p>
</div>
<div class="paragraph">
<p>In 1987, the <strong>Intel 387DX</strong> was introduced.
Due to its 32-bit data bus, it is incompatible with the 386SX, which has its
own math coprocessor called the <strong>387SX</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_fourth_generation">1.5. Fourth generation</h3>
<div class="paragraph">
<p><strong>Intel 486DX</strong> was introduced in 1989 and implements new features, such as
tightly coupled (i.e. true) pipelining and an integrated FPU.
The <strong>Intel 486SX</strong> variant is a version without an integrated FPU.<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup>
A <strong>Intel 487SX</strong> math coprocessor upgrade was available for 486SX
systems.<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</div>
</div>
<div class="sect2">
<h3 id="_fifth_generation">1.6. Fifth generation</h3>
<div class="paragraph">
<p>In 1993, the <strong>Intel Pentium</strong> was introduced, featuring the new <strong>P5</strong> (also known
as <strong>i586</strong>) microarchitecture, which introduces superscalar architecture, a
64-bit external data bus and branch prediction.
The Pentium MMX, introduced in 1997, first implemented the new MMX SIMD
extension.</p>
</div>
<div class="paragraph">
<p>Intel’s competitors also started building their chips on their own unique
in-house 586-class designs, such as the AMD K5 (1996) and the Cyrix 5x86 (1995)
and 6x86 (1996), rather than trying to replicate Intel’s chips, as with the
Am486, Am5x86 and Cx486.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cyrix_extensions">1.7. Cyrix extensions</h3>
<div class="paragraph">
<p>Cyrix processors and their derivatives made by National Semiconductors, AMD,
and VIA implement extensions, that are not found on any other processor.
Opcodes for those instructions were often reused by other manufacturers.</p>
</div>
<div class="paragraph">
<p>All Cyrix processors, starting with late Cx486 CPUs, include extensions to
system management mode.
The 6x86MX and MII implement an extension to MMX, called
<em>Extended Multimedia Instructions (EMMI)</em>, and an additional extension to SMM.
MediaGX and Geode GXm, GXLV, and GX1 processors implement special instructions
for display drivers for the on-chip video.
Geode GX2 and AMD Geode introduce a <em>debug management mode (DMM)</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sixth_generation">1.8. Sixth generation</h3>
<div class="paragraph">
<p>The Pentium was followed up by the Pentium Pro in 1995, which is the first
implementation of the <strong>P6</strong> (also known as <strong>i686</strong>) microarchitecture,
introducing register renaming, out-of-order execution, speculative execution,
and a 36-bit address bus, allowing for up to 64 GiBs of RAM, that could be
accessed through PAE or PSE-36.</p>
</div>
<div class="paragraph">
<p>The Pentium II, introduced in 1998, is a P6 processor with MMX.
The Pentium II was followed up by the Pentium III in 1999.
AMD released the 686-class K6 in 1997, followed up by the K6-2 in 1998, and
K6-III in 1999.</p>
</div>
</div>
<div class="sect2">
<h3 id="_seventh_generation">1.9. Seventh generation</h3>
<div class="paragraph">
<p>Seventh generation processors include the NetBurst-based Pentium 4, introduced
in 2000, and the AMD Athlon, also known as the K7, introduced in 1999.
A major feature of the Pentium 4 is SSE2.</p>
</div>
</div>
<div class="sect2">
<h3 id="_x86_64">1.10. x86-64</h3>
<div class="paragraph">
<p>The first processors to implement <strong>x86-64</strong>, a 64-bit extension, originally
proposed by AMD in 1999, are the AMD Opteron and Athlon 64, also known as the
K8, introduced in 2003.
Aside from increasing the size and count of general-purpose and SSE registers,
it introduces 64-bit linear addresses, albeit the paging scheme restricts the
linear address space to 48 bits (splitting it into to halves through sign
extension).</p>
</div>
<div class="paragraph">
<p>To maintain backwards compatibility, these new features can only be used in
long mode.
In long mode, many legacy features, such as segmentation and hardware task
switching, are restricted or unavailable.
The behavior compatible with older CPUs (i.e. real and protected mode) is
available in legacy mode.</p>
</div>
<div class="paragraph">
<p>To this day, every properly-implemented x86 processor has a large degree of
binary backwards compatibility, all the way back to the original Intel 8086.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_operating_modes">2. Operating modes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>x86 has a handful of operating modes.
On x86-64 processors, real mode and protected mode are grouped together into
<strong>legacy mode</strong>.</p>
</div>
<div class="sect2">
<h3 id="_real_mode">2.1. Real mode</h3>
<div class="paragraph">
<p><strong>Real mode</strong> is the operating mode that an x86 processor boots into.
It mostly models the original 16-bit 8086 processor, with a few extensions.
Real mode contains no access rings or memory protection of any kind.</p>
</div>
<div class="paragraph">
<p>Access to memory is done via a 16-bit <em>segment address</em> and a 16-bit <em>offset</em>,
using following formula:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><pre><span></span>physical_address = segment * 16 + offset
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>The default operand and address size is 16-bit.
The segment limit is 65536 bytes (64 kiB).
This means even when using a 32-bit address size prefix, the offset may not
exceed 65535.</p>
</div>
<div class="paragraph">
<p>Due to these limitations, software in real mode can only directly access the
first 1114096 (1 MiB + 64 kiB - 16 bytes) of physical memory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><pre><span></span>65535 * 16 + 65536 = 1114096
</pre></td></tr></table></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_unreal_mode">2.1.1. Unreal mode</h4>
<div class="paragraph">
<p><em>Unreal mode</em>, also known as <em>flat real mode</em>, <em>32-bit real mode</em>. or <em>voodoo
mode</em>, is an originally undocumented variant of real mode that alters the
segment descriptor cache, in order to allow 32-bit offsets, so that programs
may access up to 4 GiB of memory.
Unreal mode is available on the 386 and above.</p>
</div>
<div class="sect4">
<h5 id="_big_real_mode">Big real mode</h5>
<div class="paragraph">
<p><em>Big real mode</em>, also known as <em>big unreal mode</em>, sets the limit of data
segments to 4 GiB, allowing for a flat 32-bit physical address space
starting from zero if segment zero is used.</p>
</div>
</div>
<div class="sect4">
<h5 id="_huge_real_mode">Huge real mode</h5>
<div class="paragraph">
<p><em>Huge real mode</em>, also known as <em>huge unreal mode</em>, sets the limit of code
segments to 4 GiB, in addition to changing the data segment limit.
However, the high 16 bits of EIP are not saved by real mode interrupts,
making it difficult to use.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_protected_mode">2.2. Protected mode</h3>
<div class="paragraph">
<p><strong>Protected mode</strong> was introduced with the 286 and provides memory protection.
Unlike real mode, there is no linear relationship between segment address and
segment base address.
The segment base address and other properties of each segment are determined by
the <em>global descriptor table (GDT)</em> and <em>local descriptor table (LDT)</em>.
The segment address is now a segment selector, which is essentially an index
to a segment descriptor.</p>
</div>
<div class="paragraph">
<p>Protected mode provides four protection rings, Ring 0 being the most privileged
and Ring 3 being the least privileged.
Most operating systems only use Ring 0 and Ring 3.
Code running in Ring 0 may access any segment and may interface directly with
hardware.
The privileges of other Rings depend on the GDT and LDT and the state of the
CPU.
Ring 0 is often referred to as "kernel mode", and Ring 3 is often referred to
as "user mode".</p>
</div>
<div class="paragraph">
<p>The 286 allows for up to 16 MiB of RAM.
However, extensions to protected mode introduced with the 386 increase this to
4 GiB.
The 386 also introduces optional paging to protected mode, allowing for an
extra level of translation after segmentation.
Later extensions, such as PAE and PSE-36, increase the maximum size of physical
memory to beyond 4 GiB.
However, the size of linear address space is still limited to 4 GiB.</p>
</div>
<div class="paragraph">
<p>Thus, the <em>logical address</em>, consisting of segment selector and offset, is
first translated to a <em>linear address</em>, by adding the segment base address of
the corresponding segment descriptor to the offset.
If paging is enabled, the linear address is translated to a <em>physical address</em>,
otherwise the linear address corresponds to the physical address.</p>
</div>
<div class="paragraph">
<p>Protected mode has two sub-modes, depending on the current code segment.
However, 16-bit and 32-bit segment descriptors may coexist in the same
descriptor table.</p>
</div>
<div class="sect3">
<h4 id="_16_bit_protected_mode">2.2.1. 16-bit protected mode</h4>
<div class="paragraph">
<p>If the current code segment is a 16-bit segment, the default address and
operand size is 16-bit.</p>
</div>
<div class="paragraph">
<p>Code targeting real mode is largely compatible with 16-bit protected mode,
assuming, among other things, it does not attempt to do any privileged
operation, does not assume that there is a direct relationship between segment
base and segment address (as is the case in real mode), and does not try to
modify code or execute data.
In practice, most existing real mode programs do at least one of the things
listed above, rendering them incompatible with 16-bit protected mode.</p>
</div>
</div>
<div class="sect3">
<h4 id="_32_bit_protected_mode">2.2.2. 32-bit protected mode</h4>
<div class="paragraph">
<p>If the current code segment is a 32-bit segment, the default address and
operand size is 32-bit.</p>
</div>
<div class="paragraph">
<p>32-bit addressing allows for up to 4 GiB of directly addressable RAM, rather
than 64 kiB, as is the case with 16-bit addressing.
This, along with paging, largely removes the necessity for multiple segments,
as modern operating systems mostly rely on paging, and have one code segment
and one data segment per ring per linear address space, usually having the base
zero.
To a 32-bit user program, segmentation is essentially transparent, and the
address space consists of 4 GiB of flat contiguous memory.</p>
</div>
</div>
<div class="sect3">
<h4 id="_virtual_8086_mode">2.2.3. Virtual 8086 mode</h4>
<div class="paragraph">
<p><em>Virtual 8086 mode</em> was introduced with the 386, and allows the execution of
real mode programs in a virtual machine under a hypervisor in protected mode.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_system_management_mode">2.3. System management mode</h3>
<div class="paragraph">
<p>Introduced with the 386SL and 486SL (CPUs targeting laptops), and included in
the Pentium and subsequent processors, <em>system management mode</em> is mostly
transparent to the operating system.
System management mode is intended for firmware to provide functions, such as
power management, independently from the operating system that is currently
running.</p>
</div>
</div>
<div class="sect2">
<h3 id="_long_mode">2.4. Long mode</h3>
<div class="paragraph">
<p><strong>Long mode</strong> was introduced with x86-64 and allows software to use 64-bit
address and data.
Linear addresses are now 64-bit, thus allowing for a linear address space of
up to 16 EiB.
The paging scheme restricts this to 48-bit, however, with the remaining bits
being sign extended, thus producing two halves of 128 TiB of "canonical address
space".
An address that complies with this sign extension requirement is said to be in
<em>canonical form</em>.
The half starting at zero is called the (canonical) <em>lower half</em>.
The half starting at 16 EiB - 128 TiB is called the (canonical) <em>higher half</em>.</p>
</div>
<div class="paragraph">
<p>If 5-level paging (also known as LA57) is enabled, the canonical address space
is extended to 57-bit, thus extending the maximum amount of virtual memory from
256 TiB to 128 PiB.</p>
</div>
<div class="paragraph">
<p>Much like protected mode, long mode has three sub-modes, depending on the
current code segment.</p>
</div>
<div class="sect3">
<h4 id="_64_bit_mode">2.4.1. 64-bit mode</h4>
<div class="paragraph">
<p>If the current code segment is 64-bit, the code is interpreted as 64-bit code
and 64-bit registers may be used.
Many legacy features of protected mode, such as segmentation, are largely
disabled.
CS, DS, ES and SS always have base zero, while FS and GS may have
a non-zero base.
No segment limit checks are performed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_compatibility_mode">2.4.2. Compatibility mode</h4>
<div class="paragraph">
<p><em>Compatibility mode</em> (not to be confused with legacy mode) is a sub-mode of
long mode, that allows 16-bit and 32-bit applications to run alongside 64-bit
applications.
Segmentation works like in protected mode, but many features only directly
visible to the operating system, such as paging, system calls, and interrupts,
work as they do in 64-bit mode.
Certain features, such as virtual 8086 protected mode, no longer work under
compatibility mode.</p>
</div>
<div class="sect4">
<h5 id="_16_bit_compatibility_mode">16-bit compatibility mode</h5>
<div class="paragraph">
<p>If the current code segment is 16-bit, the code will be interpreted as 16-bit
code.
As with 16-bit protected mode, most existing real mode software cannot be run
in 16-bit compatibility mode.</p>
</div>
</div>
<div class="sect4">
<h5 id="_32_bit_compatibility_mode">32-bit compatibility mode</h5>
<div class="paragraph">
<p>If the current code segment is 32-bit, the code will be interpreted as 32-bit
code.
32-bit compatibility mode allows existing 32-bit programs to be run under long
mode.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_x86_virtualization">2.4.3. x86 virtualization</h4>
<div class="paragraph">
<p>Modern x86 processors provide hardware-assisted virtualization.
Intel processors have <em>VT-x</em> (also known as VMX) and AMD processors have
<em>AMD-V</em> (also known as SVM).</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instruction_set_and_execution_model">3. Instruction set and execution model</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each of the major x86 generations introduce major additions to the core
instruction set.</p>
</div>
<div class="paragraph">
<p>In the context of x86, a <em>word</em> is a 16-bit value, a <em>dword</em> is a 32-bit value,
and a <em>qword</em> is a 64-bit value.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Cells of tables describing a data structure may be left empty, labeled
"reserved", "0", or "1", in order to indicate this field is reserved.
Software should make no assumption about the value of these fields.
Modifying reserved bits of CPU registers should be avoided.
Memory fields marked as "reserved" should be set to zero.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_8086">3.1. 8086</h3>
<div class="paragraph">
<p>The 8086 and 8088 have a 20-bit physical address space of 1 MiB of RAM, that
is accessed through two 16-bit values called the <em>segment</em> and <em>offset</em>.
The segment is shifted left by 4 bits (i.e. multiplied by 16) and then added to
the offset to obtain the 20-bit physical address.</p>
</div>
<div class="paragraph">
<p>In addition to regular RAM, there is a 16-bit address space of 65536 byte-sized
I/O ports, that can be accessed through the <code>in</code> and <code>out</code> instructions.</p>
</div>
<div class="sect3">
<h4 id="_registers">3.1.1. Registers</h4>
<div class="paragraph">
<p>The 8086 has eight word-sized and eight byte-sized general-purpose registers.
These byte-sized registers are aliases for individual bytes of the word-sized
general-purpose registers AX, BX, CX, and DX.
The byte register AL is an alias for the low byte of AX, the byte register AH
is an alias for the high byte of AX.
Analogous relationships exist between BL, BH, and BX, CL, CH, and CX, and DL,
DH, and DX.
The remaining 16-bit general-purpose registers are SI (source index), DI
(destination index), BP (base pointer), and SP (stack pointer).</p>
</div>
<div class="paragraph">
<p>In addition to the general purpose registers, there are four word-sized segment
registers: the code segment CS, the data segment DS, the extra segment ES and
the stack segment SS.
There are also two word-sized registers, that are only indirectly accessible to
the programmer: the 16-bit instruction pointer IP and the FLAGS register.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. 8086 registers</caption>
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5454%;">
<col style="width: 4.5463%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Register name</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AX (accumulator)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AH</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CX (counter)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CH</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DX (auxiliary accumulator)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DH</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BX (base address)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BH</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SP (stack pointer)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BP (base pointer)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">BP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SI (source index)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DI (destination index)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP (instruction pointer)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLAGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZF</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PF</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ES (extra segment)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">ES</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS (code segment)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">CS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS (stack segment)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS (data segment)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DS</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The 8086 has following flags:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Carry flag (CF)</dt>
<dd>
<p>Indicates an arithmetic carry for unsigned operations.</p>
</dd>
<dt class="hdlist1">Parity flag (PF)</dt>
<dd>
<p>Is set if the parity of the result of an arithmetic
operation is even.</p>
</dd>
<dt class="hdlist1">Adjust flag (or auxiliary carry flag, AF)</dt>
<dd>
<p>Indicates a carry out of the first
nibble of an arithmetic operation.</p>
</dd>
<dt class="hdlist1">Zero flag (ZF)</dt>
<dd>
<p>Is set if the result is zero.</p>
</dd>
<dt class="hdlist1">Sign flag (SF)</dt>
<dd>
<p>Indicates a negative value as the result of a signed
arithmetic operation.</p>
</dd>
<dt class="hdlist1">Trap flag (TF)</dt>
<dd>
<p>If set, interrupt 1 (see below) is raised on each instruction
that is executed.
The trap flag is automatically cleared when an interrupt is
dispatched.</p>
</dd>
<dt class="hdlist1">Interrupt flag (IF)</dt>
<dd>
<p>If cleared, all hardware interrupts are disabled, except
for NMI.
The interrupt flag is automatically cleared when an
interrupt is dispatched.</p>
</dd>
<dt class="hdlist1">Direction flag (DF)</dt>
<dd>
<p>Determines the direction of string operations.
If it is cleared, the indices (SI or DI) involved are
increased.
If it is set, the indices are decreased.</p>
</dd>
<dt class="hdlist1">Overflow flag (OF)</dt>
<dd>
<p>Is set if a signed arithmetic operation results in an
overflow.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_instruction_modes">3.1.2. Instruction modes</h4>
<div class="paragraph">
<p>Since memory is accessed through a segment address (which is always the value
of one of the segment registers), in addition to an offset (the notation
segment:offset is used), the program counter and stack pointer consist of two
16-bit registers.
The program counter is CS:IP and the stack pointer is SS:SP.</p>
</div>
<div class="paragraph">
<p>The normal flow of execution is increasing IP.
CS is not automatically incremented if IP exceeds the limit of CS, instead, IP
either wraps around to zero (as is the case on the 8086), or an exception is
raised on later CPUs.</p>
</div>
<div class="paragraph">
<p>On x86, the stack grows downwards: <code>push</code> decreases SP and <code>pop</code> increases
SP.
As with the program counter, exceeding the limits of the stack segment does not
result in a change in SS.</p>
</div>
<div class="paragraph">
<p>Despite having eight general-purpose registers, the 8086 instruction set is not
very orthogonal.
Every 16-bit register has a special role in at least one instruction, examples
include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AL is the 8-bit accumulator, and is used to store the quotient of a
<code>div byte</code> instruction.</p>
</li>
<li>
<p>AH is used to store the remainder of a <code>div byte</code> instruction.</p>
</li>
<li>
<p>AX is used to store the quotient of a <code>div word</code> instruction.</p>
</li>
<li>
<p>BX is used as the table base address for the <code>xlat</code> instruction.</p>
</li>
<li>
<p>CX is used as a counter for the <code>loop</code> instruction.</p>
</li>
<li>
<p>DX is used to store the remainder of a <code>div word</code> instruction.</p>
</li>
<li>
<p>SI is used as the source address for the <code>movsb</code> and <code>movsw</code> instructions.</p>
</li>
<li>
<p>DI is used as the destination address for the <code>movsb</code> and <code>movsw</code>
instructions.</p>
</li>
<li>
<p>Using BP as the base of the effective address (see below), will result in
the use of the stack segment.</p>
</li>
<li>
<p>SP is the stack pointer.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every instruction involving memory has a default segment, and most may be
overridden using a <strong>segment override prefix</strong>.
Most memory operands may have a wide variety of indirect addressing modes.
Offsets may be determined through a runtime computation of adding up to three
values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>base</strong> - either zero, BX or BP</p>
</li>
<li>
<p><strong>index</strong> - either zero, SI or DI</p>
</li>
<li>
<p><strong>displacement</strong> - a constant value (encoding allows either zero, a
sign-extended byte, or a word)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The result of the computation is called the <strong>effective address (EA)</strong> (one may
write <code>[base + index + displacement]</code> to refer to the corresponding memory
address, or <code>[segment:base + index + displacement]</code> when using a segment
override).
The default segment is DS, except when the base is BP, in which case it is SS.</p>
</div>
<details>
<summary class="title">8086 addressing modes</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Effective address</th>
<th class="tableblock halign-left valign-top">Displacement formats</th>
<th class="tableblock halign-left valign-top">Default segment</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bx + si + disp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero, byte or word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bx + di + disp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero, byte or word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bp + si + disp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero, byte or word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bp + di + disp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero, byte or word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>si + disp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero, byte or word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>di + disp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero, byte or word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bp + disp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Byte or word<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disp</code> <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>di + disp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero, byte or word</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
</tr>
</tbody>
</table>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_memory_models">3.1.3. Memory models</h4>
<div class="paragraph">
<p>Since 16-bit segments are limited to 64 kiB, applications may use multiple
segments, meaning that there are multiple ways to organize a program into
memory segments.
These schemes are called <strong>memory models</strong>.
There are six standard memory models, that are widely supported by compilers
and assemblers:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Tiny</dt>
<dd>
<p>Everything is in a single segment.</p>
</dd>
<dt class="hdlist1">Small</dt>
<dd>
<p>One code segment; one data segment.</p>
</dd>
<dt class="hdlist1">Compact</dt>
<dd>
<p>One code segment; multiple data segments.</p>
</dd>
<dt class="hdlist1">Medium</dt>
<dd>
<p>Multiple code segments; one data segment.</p>
</dd>
<dt class="hdlist1">Large</dt>
<dd>
<p>Multiple code segments; multiple data segments.</p>
</dd>
<dt class="hdlist1">Huge</dt>
<dd>
<p>Single memory range up to 1 MiB (see below).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>There exist three types of pointers:
Near pointers:: Word-sized offsets that are used when there is no ambiguity
                regarding the segment.
Far pointers:: Dword-sized segment-offset pairs that are used when there is a
               necessity to specify what segment is used.
Huge pointers:: Similar to far pointers, in that they are dword-sized
                segment-offset pairs, and are used in the huge memory model.</p>
</div>
<div class="paragraph">
<p>The <strong>huge memory model</strong> takes advantage of the linear relationship between
segment address and segment base in real mode to treat the entire 1 MiB range
as a single memory segment.
This is done through huge pointers, which are essentially far pointers that are
normalized, so the offset is always smaller than 16.
This effectively yields a 20-bit address if the highest 12 bits of the offset
are ignored (since they are always zero due to normalization).
This allows the transparent implementation of arrays larger than 64 kiB.
The stack, however, may not exceed 64 kiB.
Due to relying on real mode segment arithmetic, it does not work in protected
mode.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. 8086 memory models</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Memory model</th>
<th class="tableblock halign-left valign-top">Code pointer type</th>
<th class="tableblock halign-left valign-top">Data pointer type</th>
<th class="tableblock halign-left valign-top">Segment registers</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tiny</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Near</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Near</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS = DS = ES = SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Small</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Near</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Near</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS = SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compact</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Near</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Far</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Medium</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Far</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Near</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS = SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Large</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Far</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Far</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Huge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Huge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Huge</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_interrupts_and_exceptions">3.1.4. Interrupts and exceptions</h4>
<div class="paragraph">
<p>The 8086 supports 256 types of interrupts.
Interrupts may be caused by hardware, by a CPU exception, or explicitly by
software through the <code>int</code> instruction.
When an interrupt is raised, the processor pushes the current state of the
flags register, current code segment, and the offset of the next instruction
to be executed when the interrupted program is resumed.
It then determines the address to jump to using the <strong>interrupt vector table
(IVT)</strong>, a 1 kiB (256 times 4 bytes) table, starting at physical address zero,
consisting of far pointers.</p>
</div>
<div class="paragraph">
<p>The routine that is called when an interrupt happens is called the <strong>interrupt
service routine (ISR)</strong>.
An ISR may resume the interrupted program through the <code>iret</code> instruction.
The 8086 generates following CPU exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Division by zero (interrupt 0) occurs when a <code>div</code> or <code>idiv</code> instruction has
operand zero or when the quotient does not find into the accumulator.</p>
</li>
<li>
<p>Single-step trap (interrupt 1) occurs when the trap flag (see above) is set.</p>
</li>
<li>
<p>Debug breakpoint (interrupt 3) is invoked when the (single byte) <code>int3</code>
instruction is executed.</p>
</li>
<li>
<p>Overflow (interrupt 4) is invoked when the <code>into</code> (interrupt on overflow)
instruction is executed and the overflow flag is set.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Interrupt 2 is dispatched when a non-maskable hardware interrupt, or NMI,
occurs.
Intel reserved the first 32 interrupts for future use (i.e. additional CPU
exceptions).
IBM did not heed that recommendation, causing compatibility issues.</p>
</div>
<details>
<summary class="title">Call and interrupt stack</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Near call</th>
<th class="tableblock halign-left valign-top">Far call</th>
<th class="tableblock halign-left valign-top">Interrupt</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 6</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Caller stack</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Caller stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Caller stack</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLAGS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
</tr>
</tbody>
</table>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_80186">3.2. 80186</h3>
<div class="paragraph">
<p>The 186 and 188 implement all of the new 286 instructions that are not related
to protected mode.
New CPU exceptions, such as the invalid opcode exception, were also introduced.
These extensions consist of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>immediate modes for <code>imul</code>, <code>push</code> and the shift and roll instructions</p>
</li>
<li>
<p>string operations on I/O ports</p>
</li>
<li>
<p><code>bound</code> instruction and the bounds range exceeded exception (interrupt 5)</p>
</li>
<li>
<p>shorthands <code>enter</code>, <code>leave</code>, <code>pusha</code>, <code>popa</code></p>
</li>
<li>
<p>invalid opcode (interrupt 6) and coprocessor not present exceptions
(interrupt 7)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The 186 and 188 are still very similar to the 8086 and 8088.
No new registers are added, and the behavior of <code>push sp</code> and <code>pushf</code> are the
same as with the 8086.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_80286">3.3. 80286</h3>
<div class="paragraph">
<p>The introduction of protected mode with the 286 is a major change to the x86
ISA.
Protected mode introduces new data structures, mechanisms for virtual memory,
memory protection, hardware task switching, and the ability to access a 24-bit
physical address space of 16 MiB.</p>
</div>
<div class="paragraph">
<p>Hardware memory protection is primarily enforced through <strong>protection rings</strong>.
Ring 0 is the most privileged; Ring 3 is the least privileged.
Rings with lower number (more privilege) are referred to hereafter as <em>lower</em>;
rings with higher number (less privilege) are referred to hereafter as <em>higher</em>
(i.e. the numeric relation).</p>
</div>
<details>
<summary class="title">286 registers</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 15.7894%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2641%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Register</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AX</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AH</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CX</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CH</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DX</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DH</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BX</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BH</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">BP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SI</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DI</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLAGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NT</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>IOPL</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MSW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EM</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PE</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ES<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup></p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">ES (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top" colspan="14"><p class="tableblock">(visible CS selector)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">CPL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
<td class="tableblock halign-left valign-top" colspan="14"><p class="tableblock">(visible SS selector)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">CPL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TR</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">TR (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDTR</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">LDTR (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">GDTR</p></td>
<td class="tableblock halign-left valign-top" colspan="8"></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Base (23:16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Base (15:0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">IDTR</p></td>
<td class="tableblock halign-left valign-top" colspan="8"></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Base (23:16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Base (15:0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
</tbody>
</table>
</div>
</details>
<div class="sect3">
<h4 id="_segmentation">3.3.1. Segmentation</h4>
<div class="paragraph">
<p>There is no longer a linear relationship between segment address and segment
base.
Instead, the properties of segments are determined by <strong>segment descriptors</strong>.
The values of the segment registers are now interpreted as <strong>segment selectors</strong>.
The segment selector is essentially an index to one of the two segment
descriptor tables: the <strong>Global Descriptor Table (GDT)</strong> and the <strong>Local
Descriptor Table (LDT)</strong>.</p>
</div>
<div class="paragraph">
<p>As the names suggest, the GDT contains segment descriptors for every task, and
the LDT contains segment descriptors for a specific task.
Thus, each task can access a global virtual address space, in addition to
having its own private address space.</p>
</div>
<div class="paragraph">
<p>The IVT is replaced by the <strong>Interrupt Descriptor Table (IDT)</strong>.
The IDT has an identical format to the GDT and LDT, but instead of referring to
entries in the IDT through segment selectors, each entry in the IDT corresponds
to an interrupt type (i.e. the first entry corresponds to interrupt 0, the
second to interrupt 1, and so on), with the descriptor defining the ISR to be
used.</p>
</div>
<div class="paragraph">
<p>The 286 includes facilities for managing multiple tasks.
The state of a task is stored in a <strong>Task State Segment (TSS)</strong>.
Both LDT and TSS are segments, much regular segments, and have a corresponding
entry in the GDT.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Segment selector format</caption>
<colgroup>
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="13"><p class="tableblock">Index</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TI</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">RPL</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Index</dt>
<dd>
<p>The index within the descriptor table.</p>
</dd>
<dt class="hdlist1">TI</dt>
<dd>
<p>The table indicator.
Zero for GDT; one for LDT.</p>
</dd>
<dt class="hdlist1">RPL</dt>
<dd>
<p>The requested privilege level.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Descriptor tables are arrays of 8-byte segment descriptors, that reside in RAM.
The first entry of the GDT is reserved.
Selectors referring to this entry are so-called <em>null selectors</em>, and may be
used as placeholder values for DS and ES, but not CS and SS.
Any attempt to access memory through a null selector results in a general
protection fault.
The IDT may only contain task, interrupt, or trap gates.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. 286 segment descriptor</caption>
<colgroup>
<col style="width: 15.7894%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2641%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Offset</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+48</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Reserved</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">DPL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Base (23:16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+16</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Base (15:0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Limit</dt>
<dd>
<p>The highest allowed offset address (inclusive).
This means a limit of 65535 indicates a segment of 65536 bytes; a limit
of zero indicates a segment of one byte.
For expand-down segments, it is the lowest allowed offset address minus
one (i.e. exclusive), with the maximum allowed offset being 65535.
A limit of 65535 indicates an empty segment; a limit of zero indicates
a segment of 65535 bytes.
If the present bit is not set, this field may be used for other data.</p>
</dd>
<dt class="hdlist1">Base</dt>
<dd>
<p>Physical address of the first byte of the segment (equivalent to offset
zero).
For expand-down segments, defines the first byte after the last byte
of the segment (also effectively equivalent to offset zero).
If the present bit is not set, this field may be used for other data.</p>
</dd>
<dt class="hdlist1">Type</dt>
<dd>
<p>Meaning depends on the whether it is a system segment descriptor.</p>
</dd>
<dt class="hdlist1">S flag</dt>
<dd>
<p>Zero for system segment descriptors; one for code or data descriptors.</p>
</dd>
<dt class="hdlist1">DPL</dt>
<dd>
<p>Descriptor privilege level.</p>
</dd>
<dt class="hdlist1">Present bit (P)</dt>
<dd>
<p>Zero indicates the segment is invalid (intended for operating
systems to implement swapping).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The fifth byte of a descriptor (i.e. the type, S, DPL, and P fields) is known
as the <strong>access byte</strong>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Code and data segment types</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">43</th>
<th class="tableblock halign-left valign-top">42</th>
<th class="tableblock halign-left valign-top">41</th>
<th class="tableblock halign-left valign-top">40</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RW</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Executable bit (X)</dt>
<dd>
<p>One for code segments; zero for data segments.</p>
</dd>
<dt class="hdlist1">Conforming/expand-down bit (CE)</dt>
<dd>
<p>For code segments: zero for nonconforming
code segments; one for conforming code
segments.
For data segments: zero for expand-up data
segments; one for expand-down data segments.</p>
</dd>
<dt class="hdlist1">Readable/writable bit (RW)</dt>
<dd>
<p>For code segments: zero for execute-only code
segments; one for readable code segments.
For data segments: zero for read-only data
segments; one for writable data segments.</p>
</dd>
<dt class="hdlist1">Accessed bit (A)</dt>
<dd>
<p>This bit is set when a segment is accessed.
This way the operating system can keep track of which
segments were used.</p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. 286 system segment types</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 33.3333%;">
<col style="width: 40.0003%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">43</th>
<th class="tableblock halign-left valign-top">42</th>
<th class="tableblock halign-left valign-top">41</th>
<th class="tableblock halign-left valign-top">40</th>
<th class="tableblock halign-left valign-top">Segment type</th>
<th class="tableblock halign-left valign-top">Descriptor tables</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Available TSS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GDT only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDT descriptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GDT only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Busy TSS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GDT only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call gate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Task gate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GDT, LDT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt gate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDT only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trap gate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDT only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Gates have a different format to other segment descriptors (i.e. code, data,
LDT, and TSS segments).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. 16-bit gate descriptor</caption>
<colgroup>
<col style="width: 15.7894%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2641%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Offset</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+48</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Reserved</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">DPL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">Word count</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+16</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Segment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Offset</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Offset</dt>
<dd>
<p>Target offset (unused by task gate).</p>
</dd>
<dt class="hdlist1">Segment</dt>
<dd>
<p>Target segment selector.
Must point to code segment for call, interrupt, and trap gates, and
to a TSS for task gates.
The RPL field is ignored by call, interrupt, and trap gates.</p>
</dd>
<dt class="hdlist1">Word count</dt>
<dd>
<p>Amount of words to push.
Call gates only; reserved for all other kinds of gate.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In addition to the visible 16-bit selectors, all segment registers have an
invisible <em>segment descriptor cache</em>,<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>
which contains the segment descriptor corresponding to the selector, so that
the CPU does not need to constantly look up the descriptor tables.</p>
</div>
<div class="paragraph">
<p>The location of the GDT, LDT, IDT, and TSS are indicated by the <em>GDT Register
(GDTR)</em>, <em>LDT Register (LDTR)</em>, <em>IDT Register (IDTR)</em> and <em>Task Register (TR)</em>
respectively.
The LDTR and TR are similar to regular segment registers, as they store a
16-bit selector, visible to the programmer, and a hidden descriptor cache.
The LDTR can be set using the <code>lldt</code> instruction, and the TR can be set using
the <code>ltr</code> instruction.
Both of these instructions accept a 16-bit direct operand (register or
memory), containing a selector pointing to the corresponding descriptor in the
GDT.</p>
</div>
<div class="paragraph">
<p>The GDT and IDT are not segments. and the GDTR and LDTR do not have the visible
16-bit selector part.
The GDTR and LDTR are effectively 48-bit registers and may be set using the
<code>lgdt</code> and <code>lidt</code> instructions respectively, which take a pointer to a 6 byte
structure, called a <em>pseudo-descriptor</em>, that is similar to a regular segment
descriptor, due to having base and limit fields.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. 286 pseudo-descriptor format</caption>
<colgroup>
<col style="width: 15.7894%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2641%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Offset</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+32</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Base (23:16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+16</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Base (15:0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_memory_protection">3.3.2. Memory protection</h4>
<div class="paragraph">
<p>Protected mode introduces new memory protection mechanisms.
In order to understand these, one must first understand the different privilege
levels that are taken into account:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <em>_current privilege level (CPL)</em> is the privilege level of the current
task.
It corresponds to the RPL field of the segment selectors stored in CS and
SS (i.e. bits 0 and 1 of the visible 16-bit values of CS and SS).</p>
</li>
<li>
<p>The <em>descriptor privilege level (DPL)</em> is the privilege level of the
segment being accessed (determined in the segment descriptor).</p>
</li>
<li>
<p>The <em>requested privilege level (RPL)</em> is the privilege level given by the
segment selector (i.e. bits 0 and 1 of the segment selector).</p>
</li>
<li>
<p>The <em>effective privilege level (EPL)</em> is the maximum of the CPL and RPL.</p>
</li>
<li>
<p>The <em>I/O privilege level (IOPL)</em> is a value in the FLAGS register, that
determines the highest CPL allowed to do direct I/O (<code>in</code>, <code>out</code>, <code>ins</code> and
<code>outs</code>), to set and clear the interrupt flag (<code>cli</code> and <code>sti</code>) and to use the
<code>lock</code> prefix within the current task.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Trying to set IF indirectly through <code>popf</code> or <code>iret</code> with NT cleared, results
in no change of IF, if the CPL is higher than the IOPL.
The IOPL also remains unchanged after <code>popf</code> or <code>iret</code> with NT cleared, unless
the CPL is zero.
A task switch can always modify any flag.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Certain instructions, such as <code>lgdt</code>, can only be used if the CPL is 0.
There are also forms of protection independent of the privilege levels, such as
checking segment limits, restricting writing a code segment, or read-only data
segment, and restricting reading an execute-only code segment through a CS
override.</p>
</div>
<div class="paragraph">
<p>Before accessing a segment, a segment register must first be set.
This CPU means the can perform most privilege checks at that point, instead of
every time memory is read or written.
The particular privilege level checks depends on how the segment register is
set and the type of descriptor the selector points to.</p>
</div>
<div class="paragraph">
<p>DS, ES, and SS can be changed directly through <code>mov</code> and <code>pop</code>.
In general, these registers must be loaded with data segments or readable code
segments with the DPL higher or equal to the EPL.
However, different rules may apply (see table, e.g. SS must always point to a
writable segment with DPL equal to CPL).</p>
</div>
<div class="paragraph">
<p>LDTR and TR can only be changed explicitly in Ring 0 using the <code>lldt</code> and
<code>ltr</code> instructions.
The LDTR must be loaded with a selector pointing to a valid LDT descriptor in
the GDT.
The TR must be loaded with a selector pointing to a valid TSS descriptor in the
GDT.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Conditions for successful update of segment registers</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">Mechanism</p></th>
<th class="tableblock halign-left valign-top" colspan="7"><p class="tableblock">Target</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data segment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonconforming code segment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conforming code segment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call gate to nonconforming code segment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Call gate to conforming code segment</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSS or task gate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt or trap gate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updating DS or ES</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>DPL &gt;= EPL</code> and readable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Readable</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Disallowed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updating SS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DPL == RPL == CPL</code> and writable</p></td>
<td class="tableblock halign-left valign-top" colspan="6"><p class="tableblock">Disallowed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updating CS through far <code>jmp</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Disallowed</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>DPL == CPL &amp;&amp; RPL &lt;= CPL</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>DPL &lt;= CPL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gate DPL &gt;= gate EPL &amp;&amp; target DPL == CPL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gate DPL &gt;= gate EPL &amp;&amp; target DPL &lt;= CPL</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>gate DPL &gt;= tss EPL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disallowed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updating CS through far <code>call</code> or <code>int</code></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>gate DPL &gt;= gate EPL &amp;&amp; target DPL &lt;= CPL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gate DPL &gt;= CPL &amp;&amp; target DPL &lt;= CPL</code> <sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updating CS through <code>retf</code> or <code>iret</code></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code>RPL &gt;= CPL</code></p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Disallowed</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Segment registers may be changed implicitly through instructions (and
interrupts) that pass control flow to another code segment.
A control transfer to a nonconforming code segment results in the CPL being set
to the DPL of the incoming code segment.
A control transfer to a conforming code segment results in no change in DPL.
Not just CS and IP may be changed as a result of a transfer to another code
segment.
If the operation results in a change in CPL, the stack is also switched
(meaning a change in SS and SP).</p>
</div>
<div class="paragraph">
<p>Control transfers may also target a TSS, instead of a code segment, resulting
in a task switch, with the task described by the TSS being resumed, and the
state of the outgoing task being saved in the TSS of the outgoing task.
This results in most CPU registers (including LDTR) being changed and the
incoming task resuming at the state described by its TSS (including the CPL,
which is stored in the RPL field of CS and SS).</p>
</div>
<div class="paragraph">
<p>Operations that result in a change of code segment include far <code>jmp</code> and
<code>call</code>, which provide a far pointer, or an interrupt (that can be caused by an
<code>int</code> instruction), which provides an interrupt vector.
Either way, these point to an unique segment descriptor.
The segment selector of the far pointer points to a segment descriptor in the
GDT or LDT, while the interrupt vector points to a segment descriptor in the
IDT.</p>
</div>
<div class="paragraph">
<p><code>jmp</code> and <code>call</code> may target a code segment, call gate, or task gate.
A <code>jmp</code> instruction may not result in a change of CPL (violations of this, i.e.
through targeting a nonconforming segment with DPL not equal to CPL, result in
a general protection fault).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a code segment is targeted, control is transferred to that code segment at
the offset provided as the operand of the instruction (assuming no protection
violations or other faults).
As with <code>jmp</code> instructions, a <code>call</code> instruction directly targeting a code
segment may not result in a change of CPL (i.e. it must be a "intra-level"
call).
<code>call</code> behaves similar to real mode, in the sense that it pushes a far
pointer to stack for <code>retf</code> to pop.</p>
</li>
<li>
<p>If a call gate is targeted, control is transferred to the code segment at the
offset provided by the call gate descriptor.
The offset provided by the instruction is ignored.
A <code>call</code> to a call gate allows control to be transferred from less privileged
code to more privileged code (i.e. the CPL gets lower, "inter-level call").
If a change in CPL occurs, a stack switch to the stack corresponding to the
new protection ring, as defined in the TSS, occurs.
If a stack switch occurs, the processor first pushes SS and SP, then copies
the amount of words given in the word count descriptor field to the new stack
and then pushes CS and IP.
Note the call gate has following properties:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It is transparent to the application.
The application simply does <code>jmp</code> or <code>call</code> as if it was a code segment.</p>
</li>
<li>
<p>The word count mechanism allows for transparent passing of parameters on
the stack.</p>
</li>
<li>
<p>The offset operand of the <code>jmp</code> or <code>call</code> instruction is ignored.
This prevents an application from entering the middle of a procedure, or a
procedure it should not enter.</p>
</li>
<li>
<p>The procedure can transparently return via <code>retf</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If a TSS or task gate is targeted, the task described by the TSS (or the TSS
pointed to by the selector in the task gate) is resumed.
For a procedure invoked via a TSS or task gate to properly return, it must
use <code>iret</code>, not <code>retf</code>.</p>
</li>
</ul>
</div>
<details>
<summary class="title">Call gate stack</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Intra-level</th>
<th class="tableblock halign-left valign-top">Inter-level</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 12</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Caller stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">= SSn:SPn<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parameter 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
</tr>
</tbody>
</table>
</div>
</details>
<div class="paragraph">
<p>The actions of the <code>retf</code> instruction depend on the segment selector of the
far return pointer on the stack.
The selector part of the pointer must point to a valid code segment.
The RPL of that selector indicates the CPL of the caller.
If the RPL equals the CPL, no CPL change is necessary and the <code>retf</code>
instruction behaves like the <code>retf</code> instruction in real mode.
Otherwise, a stack switch occurs by restoring the caller SP and SS on the
callee stack.
In addition <code>retf</code> checks the DPL of DS and ES and sets them to null selectors
if they are lower than the caller CPL.</p>
</div>
<details>
<summary class="title">16-bit TSS structure</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 23.8095%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.7619%;">
<col style="width: 4.762%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Byte offset</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Previous TSS selector backlink</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SP for Ring 0 (SP0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SS  for Ring 0 (SS0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SP for Ring 1 (SP1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SS  for Ring 1 (SS1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SP for Ring 2 (SP2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SS  for Ring 2 (SS2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">FLAGS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">AX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">CX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">BX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">BP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">ES</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">CS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">38</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">42</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">LDTR</p></td>
</tr>
</tbody>
</table>
</div>
</details>
<div class="paragraph">
<p>The RPL (and EPL) mechanism serves to prevent privilege escalation (i.e. a
less privileged program accessing privileged memory indirectly through a system
call, by passing a pointer to that portion of memory).
When less privileged code passes a pointer to more privileged code, the pointer
can be tagged using the <code>arpl</code> instruction (which takes the maximum of the CPL
of the callee with the current RPL of the selector).
This means pointers are tagged with the CPL of the original caller.</p>
</div>
<div class="paragraph">
<p>For example, a procedure with CPL 3 passes a selector with RPL 0 pointing to a
descriptor with DPL 2 to a procedure with CPL 2, that in turn calls a procedure
with CPL 0.
When the procedure with CPL 2 is invoked, it executes <code>arpl</code> and sets the RPL
of the selector to 3 (which is the maximum of CPL 3 and RPL 0).
The procedure with CPL 0 also invokes <code>arpl</code>, and the RPL of the selector
remains 3 (which is the maximum of CPL 2 and RPL 3).
Throughout all the stages, the EPL remains 3, which means a general protection
fault will be raised when accessing this pointer, even in Ring 0, since the EPL
is larger than the DPL.</p>
</div>
</div>
<div class="sect3">
<h4 id="_interrupts_and_task_switching">3.3.3. Interrupts and task switching</h4>
<div class="paragraph">
<p>Interrupts behave in a similar way to the <code>call</code> instruction.
The effect depends on the corresponding IDT entry:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the target is an interrupt or trap gate, it behaves in a similar way to a
call gate being invoked by a <code>call</code> instruction.
The main difference is that no parameters from the caller stack are copied if
a privilege change occurs.
Instead, the FLAGS register is always pushed, and the trap flag is cleared
(in a similar fashion to interrupts in real mode).
The only difference between an interrupt gate and a trap gate is that an
interrupt gate clears the interrupt flag (much like real mode), while a trap
gate does not.</p>
</li>
<li>
<p>If the target is a task gate, it resumes the task described by the TSS
pointed to by the task gate, much like a <code>call</code> instruction.
The interrupt flag of the incoming task is cleared.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In order to keep track of what interrupts and far calls were serviced by a task
gate, the CPU maintains the <em>nested task (NT) flag</em>.
Whenever a task switch due to an interrupt and call occurs, the NT flag of the
new task is set and the previous TSS backlink of the incoming task is filled
with the TSS selector of the outgoing task.
A task switch due to a jump clears the NT flag of the incoming task.</p>
</div>
<div class="paragraph">
<p>In addition, each TSS descriptor maintains a flag indicating whether the task
is "available" or "busy".
The currently executing task is always busy, as are previous callers in the
caller chain.
Only an available task may be resumed through a task gate; only a busy task may
be resumed through <code>iret</code>.
Entering a task gate results in the incoming task becoming busy.
While a <code>jmp</code> instruction causes the outgoing task to become available, <code>call</code>
instructions and interrupts result in the outgoing task remaining busy.
<code>iret</code> results in the callee becoming available once again.</p>
</div>
<div class="paragraph">
<p>The behavior of <code>iret</code> depends on the NT flag.
If the NT flag is cleared, <code>iret</code> behaves in a similar way to <code>retf</code>, except
that the FLAGS register (which was pushed on to the stack) is restored.
The IOPL is only changed if the callee is at Ring 0.
If the NT flag is set, indicating an interrupt or call to a task gate, <code>iret</code>
causes a task switch to the task pointed to by the selector in the previous
TSS backlink (i.e. the caller task).
The NT flag of the callee (outgoing) task is subsequently cleared.</p>
</div>
<details>
<summary class="title">Interrupt and trap gate stack</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Intra-level,<br>
  no error code</th>
<th class="tableblock halign-left valign-top">Intra-level,<br>
  error code</th>
<th class="tableblock halign-left valign-top">Inter-level,<br>
  no error code</th>
<th class="tableblock halign-left valign-top">Inter-level,<br>
  error code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 14</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">Caller stack</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">Caller stack</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">= SSn:SPn</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">= SSn:SPn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLAGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLAGS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLAGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FLAGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp + 2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Error code</p></td>
</tr>
</tbody>
</table>
</div>
</details>
<div class="paragraph">
<p>The 286 introduces a plethora of new exceptions.
Protected mode exceptions may push a 16-bit error code on top of the stack,
usually indicating a descriptor entry related to the exception (the exact
descriptor entry depends on the exact kind of exception).
The error code may also be zero.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Error code format</caption>
<colgroup>
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="13"><p class="tableblock">Index</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">TI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Index</dt>
<dd>
<p>The index within the descriptor table.</p>
</dd>
<dt class="hdlist1">Table indicator (TI)</dt>
<dd>
<p>Zero for GDT; one for LDT.</p>
</dd>
<dt class="hdlist1">Interrupt (I)</dt>
<dd>
<p>Zero for GDT or LDT; one for IDT.
External (EX): Set if exception caused by external interrupt.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Exceptions are classified into three types:<sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Fault</dt>
<dd>
<p>Indicates a non-critical error has happened.
These errors can be corrected and the program can be restarted at the
faulting instruction.</p>
</dd>
<dt class="hdlist1">Trap</dt>
<dd>
<p>Traps allow a program to be restarted at the instruction following the
trapping instruction.</p>
</dd>
<dt class="hdlist1">Abort</dt>
<dd>
<p>Aborts cannot be restarted reliably and indicate a critical error.</p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. 286 exceptions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vector</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Error code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Divide by zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contributory<sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnotedef_11" title="View footnote.">11</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trap<sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnotedef_12" title="View footnote.">12</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Breakpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overflow</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bounds range exceeded</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invalid opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coprocessor not present</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes<sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnotedef_13" title="View footnote.">13</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coprocessor segment overrun<sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnotedef_14" title="View footnote.">14</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contributory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invalid TSS<sup class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnotedef_15" title="View footnote.">15</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contributory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Segment not present</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contributory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stack fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contributory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General protection fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault<sup class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnotedef_16" title="View footnote.">16</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contributory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Coprocessor error<sup class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnotedef_17" title="View footnote.">17</a>]</sup></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When an exception occurs while an exception handler is being dispatched, the
result depends on the kind of exception.
It may either handle them serially, dispatch a <strong>dobule fault</strong>, or enter a
<strong>triple fault</strong>.
When a triple fault occurs, the processor shuts down.
Depending on the motherboard, this usually causes the computer to be rebooted.</p>
</div>
<div class="paragraph">
<p>Exceptions can be divided into four relevant classes: <em>benign</em>, <em>contributory</em>,
<em>page fault</em> (introduced with the 386) and
<em>double fault</em>.<sup class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnotedef_18" title="View footnote.">18</a>]</sup></p>
</div>
<details>
<summary class="title">Double exception handling</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">First exception</p></th>
<th class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Second exception</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contributory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page fault</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handled serially</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handled serially</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handled serially</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contributory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handled serially</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handled serially</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handled serially</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double fault</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Double fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handled serially</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triple fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Triple fault</p></td>
</tr>
</tbody>
</table>
</div>
</details>
</div>
<div class="sect3">
<h4 id="_machine_status_word">3.3.4. Machine Status Word</h4>
<div class="paragraph">
<p>The 286 also introduced a new 16-bit register called the <em>Machine Status Word
(MSW)</em>, which can only be directly modified in Ring 0 through the <code>lmsw</code> and
<code>clts</code> instructions.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Protection enabled (PE)</dt>
<dd>
<p>Set for protected mode; clear for real mode.
May not be cleared once set on a 286 (later
processors allow returning back to real mode).</p>
</dd>
<dt class="hdlist1">Monitor coprocessor (MP)</dt>
<dd>
<p>Raises coprocessor not present exception (interrupt
7) on <code>wait</code>, if MP <em>and</em> TS are set.
Should be set if a physical coprocessor is present
(i.e. the results become available asynchronously).</p>
</dd>
<dt class="hdlist1">Emulate coprocessor (EM)</dt>
<dd>
<p>Raises coprocessor not present exception on <code>esc</code>
(i.e. on every floating-point instruction) if set.
Intended for emulating an FPU if a physical one is
not present.</p>
</dd>
<dt class="hdlist1">Task switched (TS)</dt>
<dd>
<p>Raises coprocessor not present exception on <code>esc</code> if set.
Automatically set when task is switched, so that the
operating system is able to switch the x87 context for
tasks using floating-point instructions.
May be cleared again via <code>clts</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>MP, EM, and TS also affect most MMX, 3DNow!, and SSE instructions on later
CPUs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_i386">3.4. i386</h3>
<div class="paragraph">
<p>The 386 introduced 32-bit extensions, paging, virtual 8086 mode, and the
ability to return to real mode, in addition to new instructions and operand
modes.
It also allows software to change the base and limit of the real mode IVT
through the IDTR.</p>
</div>
<div class="sect3">
<h4 id="_32_bit_registers_and_addressing">3.4.1. 32-bit registers and addressing</h4>
<div class="paragraph">
<p>The 386 expanded many registers to 32-bit registers.
These new dword-sized registers have the corresponding word-sized register
aliased to its lower word.
The new registers have an "e" prefix, to differentiate them from their 16-bit
counterpart.
For example, EAX is a 32-bit register, with AX aliasing to the lower word.
Similarly EBX, ECX, EDX, ESI, EDI, EBP, ESP, EIP and EFLAGS were added.</p>
</div>
<div class="paragraph">
<p>Segment registers and selectors remain word-sized, however, offset sizes are
expanded to 32-bit, yielding a 48-bit logical address.
Two new data segment registers, similar to DS and ES, that can be used with
the corresponding segment override prefix, were introduced: FS and GS.</p>
</div>
<details>
<summary class="title">386 registers</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.5714%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8585%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Register</th>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EAX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EAX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AH (AX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AL (AX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(ECX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CH (CX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CL (CX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EDX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EDX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DH (DX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DL (DX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EBX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BH (BX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BL (BX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(ESP)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EBP)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">BP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESI</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(ESI)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EDI</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EDI)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EIP)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EFLAGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>VM</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>RF</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NT</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">IOPL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PG</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ET</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR2</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Page fault linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR3</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">Page Directory Base Register (PDBR)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR0</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 0 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR1</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 1 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR2</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 2 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR3</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 3 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>B3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>B2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>B1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>B0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR7</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>LEN3</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>R/W3</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>LEN2</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>R/W2</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>LEN1</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>R/W1</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>LEN0</strong></p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>R/W0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>GE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>LE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>G3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>L3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>G2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>L2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>G1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>L1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>G0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>L0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ES<sup class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnotedef_19" title="View footnote.">19</a>]</sup></p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">ES (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="14"><p class="tableblock">(visible CS selector)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">CPL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="14"><p class="tableblock">(visible SS selector)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">CPL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">FS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">GS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TR</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">TR (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDTR</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">LDTR (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">GDTR</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Base</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">IDR</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Base</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
</tbody>
</table>
</div>
</details>
<div class="paragraph">
<p>In addition to adding 32-bit variants to certain instructions (such as adding
<code>lodsd</code> to complement <code>lodsw</code> and <code>lodsb</code>), the 386 introduced new instructions
and instruction modes, in order to make the instruction set more orthogonal.
For example, the <code>lss</code>, <code>lfs</code>, and <code>lgs</code> instructions, in addition to the
existing <code>lds</code> and <code>les</code> instructions, new modes for <code>imul</code>, and near
conditional jumps (in addition to existing short conditional jumps) were added.
Completely new instructions were also added, such as instructions to sign
extend and zero extend smaller registers into larger registers, <code>movsx</code> and
<code>movzx</code>.</p>
</div>
<div class="paragraph">
<p>The 386 decides whether to use 32-bit or 16-bit registers based on the current
code segment.
A 32-bit code segment interprets instructions as operations on 32-bit and
8-bit registers and memory locations and uses 32-bit offsets.
A 16-bit code segment interprets instructions as operations on 16-bit and
8-bit registers and memory locations and uses 16-bit offsets, in the same way
as previous 16-bit processors of the x86 line.
16-bit operands and addresses can be used in a 32-bit code segment and vice
versa using the <strong>operand size prefix</strong> and <strong>address size prefix</strong>.</p>
</div>
<div class="paragraph">
<p>32-bit effective addresses are significantly more orthogonal than their 16-bit
counterparts.
As with 16-bit addresses, 32-bit addresses may have a base, an index, and a
displacement.
In addition, a <strong>scale</strong> may be added, that is multiplied with the index.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>base - any 32-bit general-purpose register (EAX, EBX, ECX, EDX, ESI, EDI,
EBP, ESP)</p>
</li>
<li>
<p>index - any 32-bit general-purpose register, except ESP (EAX, EBX, ECX, EDX,
ESI, EDI, EBP)</p>
</li>
<li>
<p>scale - 1, 2, 4 or 8</p>
</li>
<li>
<p>displacement - zero, 8-bit sign extended value or 32-bit value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following combinations are allowed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>displacement</code> alone</p>
</li>
<li>
<p><code>base</code> alone</p>
</li>
<li>
<p><code>base + displacement</code></p>
</li>
<li>
<p><code>index * scale + displacement</code></p>
</li>
<li>
<p><code>base + index + displacement</code></p>
</li>
<li>
<p><code>base + index * scale + displacement</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default segment is DS, except if the base is EBP or ESP, in which
case the default segment is SS.</p>
</div>
</div>
<div class="sect3">
<h4 id="_32_bit_segmentation">3.4.2. 32-bit segmentation</h4>
<div class="paragraph">
<p>In order to deal with 32-bit addresses and the extended 32-bit physical address
space of 4 GiB, the 386 introduces backwards-compatible changes to
segmentation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. 386 segment descriptor format</caption>
<colgroup>
<col style="width: 15.7894%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2641%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Offset</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+48</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Base (31:24)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Limit (19:16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">DPL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Base (23:16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+16</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Base (15:0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit (15:0)</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Limit</dt>
<dd>
<p>The Limit field is extended from 16-bit to 20-bit, allowing a limit of
up to 1 MiB (or 4 GiB using the G-flag).</p>
</dd>
<dt class="hdlist1">Base</dt>
<dd>
<p>Extended to 32-bit.</p>
</dd>
<dt class="hdlist1">Available (A)</dt>
<dd>
<p>Available for use by the operating system.</p>
</dd>
<dt class="hdlist1">DB</dt>
<dd>
<p>Set for 32-bit segment; clear for 16-bit segment.
Called the D flag for code segments and the B flag for data segments.
Meaning depends on type of segment:</p>
<div class="ulist">
<ul>
<li>
<p>For a code segment, it defines the default operand and address
size.</p>
</li>
<li>
<p>For a stack segment, it defines the size of the stack pointer (i.e.
whether to use just SP or all of ESP for stack operations).</p>
</li>
<li>
<p>For a expand-down segment, it defines the upper bound.
16-bit expand-down segments have an upper bound of 0xFFFF.
32-bit expand-down segments have an upper bound of 0xFFFFFFFF.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Granularity flag (G)</dt>
<dd>
<p>If set, limit is given in 4 kiB units, rather than units
of one byte.
The effective limit is <code>limit * 4096 + 4095</code>.
Allows for segments of up to 4 GiB.</p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. New 386 system segment types</caption>
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 33.3333%;">
<col style="width: 40.0003%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">43</th>
<th class="tableblock halign-left valign-top">42</th>
<th class="tableblock halign-left valign-top">41</th>
<th class="tableblock halign-left valign-top">40</th>
<th class="tableblock halign-left valign-top">Segment type</th>
<th class="tableblock halign-left valign-top">Descriptor tables</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Available 32-bit TSS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GDT only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Busy 32-bit TSS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GDT only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit call gate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit interrupt gate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDT only</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-bit trap gate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IDT only</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Aside from the new 32-bit segments and gates, 386 segmentation fundamentally
works the same as on the 286.
Even the behavior of the stack for 32-bit calls and interrupts works
essentially the same, except that 32-bit registers are pushed, instead of
16-bit registers, and 16-bit selectors and error codes are padded with an extra
high word, in order to become dword-aligned.
The bit width of calls and interrupts is determined by the operand size for
calls directly targeting code segments, and by the type of gate for calls and
interrupts through gates.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. 32-bit gate descriptor</caption>
<colgroup>
<col style="width: 15.7894%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2641%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Offset</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+48</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Offset (31:16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">DPL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Type</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top" colspan="5"><p class="tableblock">Dword count</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+16</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Segment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Offset (15:0)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Thus, 16-bit and 32-bit segments and gates can be largely mixed.
However, the size of the return instructions must match the size of the call
instructions and a 16-bit call from a 32-bit segment will truncate EIP.
For a 16-bit call to work as expected, it must be called from the first 64 kiB
of a segment, and can only target the first 64 kiB.</p>
</div>
<div class="paragraph">
<p>The <code>lgdt</code> and <code>lidt</code> instructions work identically to the 286, except that the
reserved byte is now used to extend the base address field to 32 bits.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. 386 pseudo-descriptor format</caption>
<colgroup>
<col style="width: 15.7894%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2631%;">
<col style="width: 5.2641%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Offset</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+32</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Base (31:16)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+16</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Base (15:0)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">+0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It is not recommended to mix 16-bit and 32-bit task state segments, due to
unintended side-effects of missing fields.
In particular, a 32-bit TSS stores the state of CR3 (i.e. the Page Directory
Base Register PDBR) and the new general-purpose registers introduced with the
386.</p>
</div>
<details>
<summary class="title">32-bit TSS structure</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 13.5135%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7027%;">
<col style="width: 2.7028%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Byte offset</th>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Previous TSS backlink</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">ESP0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SS0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">ESP1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SS1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">ESP2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SS2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">CR3 (PDBR)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">EIP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">EFLAGS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">EAX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">44</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">ECX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">EDX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">52</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">EBX</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">56</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">ESP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">EBP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">ESI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">68</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">EDI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">72</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">ES</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">76</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">CS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">84</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">88</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">FS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">92</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">GS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">96</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">LDTR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">100</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">I/O map base</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">T</p></td>
</tr>
</tbody>
</table>
</div>
</details>
<div class="dlist">
<dl>
<dt class="hdlist1">I/O map base</dt>
<dd>
<p>Base offset the <em>I/O permission bitmap</em> in the TSS.
This allows code running at a CPL higher than the IOPL to have
limited access to I/O.
In particular, each bit corresponds to an I/O port.
If the bit is cleared, code at any CPL may access that I/O port.
The TSS does not need to contain a complete I/O port bitmap,
bits beyond the limit of the TSS are treated as being set,
thereby preventing unprivileged access to the corresponding
ports.<sup class="footnote">[<a id="_footnoteref_20" class="footnote" href="#_footnotedef_20" title="View footnote.">20</a>]</sup></p>
</dd>
<dt class="hdlist1">T flag (T)</dt>
<dd>
<p>Will raise a debug trap (interrupt 1) after switching to the task,
but before executing an instruction, when set.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_paging">3.4.3. Paging</h4>
<div class="paragraph">
<p>The 386 added support for paging as an extra translation layer, in addition to
segmentation.
With paging enabled, segments are not contiguous ranges in physical address
space, but rather contiguous ranges in <em>linear address space</em>.
In particular, the base of segments is treated as a <em>linear address</em>, rather
than a physical address.
Segmentation translates a <em>logical address</em>, consisting of a 16-bit segment
address and a 32-bit offset, to a 32-bit linear address (i.e. segment bases are
no longer physical addresses, but linear addresses).
Paging is responsible for converting this linear address to a physical address.</p>
</div>
<div class="paragraph">
<p>This is achieved by dividing both linear and physical 4 GiB address spaces
into 1048576 aligned pages of 4096 bytes.
Paging maps pages of physical memory to certain spots in virtual memory.
This effectively creates a flat linear address space that is isolated from
physical memory, allowing for greater isolation of software.</p>
</div>
<div class="paragraph">
<p>Protected mode segmentation allows for a similar degree of isolation.
Segments, however, need to be contiguous and have variable size.
Pages have fixed size and are invisible to application programs, allowing for
memory to be arbitrarily fragmented and swapped out in chunks of 4096 bytes.</p>
</div>
<div class="paragraph">
<p>Entries in the translation table are 32-bit, so instead of having a single page
table of 2 MiB (more RAM than many systems had at the time), the 386 employs a
two-level paging system.
The root page table is the <strong>page directory (PD)</strong>, which has <em>page directory
entries (PDEs)</em> pointing to individual <strong>page tables (PT)</strong>, which consists of
<em>page table entries (PTEs)</em> pointing to the physical base address of individual
pages.</p>
</div>
<div class="paragraph">
<p>Both of these tables occupy 4 kiB, and thus have 1024 entries.
This means each page table (corresponding to one PDE) contains the mapping for
2 MiB of virtual memory.
Each PTE determines the mapping of a 4 kiB page.</p>
</div>
<div class="paragraph">
<p>Thus, the linear address is split into three parts.
The most significant bits determine what PDE within the PD to look up, i.e. the
<em>PD index (PDI)</em>.
The middle part determines what PTE to look up within the PT, i.e. the <em>PT
index (PTI)</em>.
The least significant part is the offset within the page itself.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. 32-bit linear address</caption>
<colgroup>
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="10"><p class="tableblock">PDI (0-1023)</p></td>
<td class="tableblock halign-left valign-top" colspan="10"><p class="tableblock">PTI (0-1023)</p></td>
<td class="tableblock halign-left valign-top" colspan="12"><p class="tableblock">Offset (0-4095)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The physical address of the PD is given by CR3.
CR3, PDEs, and PTEs are 32-bit physical addresses pointing to a PD, PT, or page
respectively.
Since all these structures must be aligned with page boundaries, the lower
12 bits of the physical address are always zero and are used for other
purposes.
All of these 12 bits are reserved in CR3 and should be zero.
The upper 20 bits of CR3 are known as the PDBR, or <em>Page Directory Base
Register</em>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. 386 page entries</caption>
<colgroup>
<col style="width: 8.5714%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8585%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entry type</th>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR3</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">PD physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDE</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">PT physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PTE</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">Page physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Physical address</dt>
<dd>
<p>The physical address of the page (for a PTE), PT (for a
PDE), or PD (for CR3).
Since pages, PTs, and PDs must be aligned, the lower 12 bits
have a different meaning, and are effectively zero when
determining the 32-bit physical base address.
Alternatively, one can thinkS of the 20-bit field as the
index of the page in physical memory.</p>
</dd>
<dt class="hdlist1">Available</dt>
<dd>
<p>These bits are available for use by the operating system.</p>
</dd>
<dt class="hdlist1">Dirty bit (D)</dt>
<dd>
<p>PTEs only.
The CPU automatically sets this bit when the corresponding page
is written to.</p>
</dd>
<dt class="hdlist1">Accessed bit (A)</dt>
<dd>
<p>The CPU automatically sets this bit when the corresponding
page, or a page mapped in the corresponding PT, is read or
written to.</p>
</dd>
<dt class="hdlist1">User/supervisor flag (U/S)</dt>
<dd>
<p>Zero for supervisor; one for user.
User pages may be accessed by code at CPL 3.
Supervisor pages may only be accessed by Rings 0,
1 and 2.</p>
</dd>
<dt class="hdlist1">Read/write flag (R/W)</dt>
<dd>
<p>Zero for read-only; one for read-write.
Read-only pages may not be written to by code at CPL 3.</p>
</dd>
<dt class="hdlist1">Present bit (P)</dt>
<dd>
<p>One indicates the entry may be used.
If zero, accessing the corresponding page or PT will cause a
page fault, and all the other bits may be used by the
operating system.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Implicit access of data structures through paging, such as the GDT, IDT, LDT or
TSS, are effectively supervisor-mode, even when the current CPL is 3, meaning
that these structures can be protected by paging, while still allowing for e.g.
segment selectors to be loaded and interrupts to be dispatched.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Page protection violations result in a page fault.
Both PTEs and PDEs hold permission bits.
For a page to be a user page, the U/S flag must be set in the corresponding
PTE <em>and</em> PDE.
For a page to be a read-write page, the R/W flag must also be set both in the
PT <em>and</em> in the PD.
This effectively means, the PDE serves as an override to the corresponding
PTEs, that restricts permissions further.</p>
</div>
<div class="paragraph">
<p>The present bit works in a similar way, in relation to whether the page may be
accessed.
If the PT itself is not present (indicated by a zero in the present bit of the
corresponding PDE), any page mapped by the PT may not be accessed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
CPUs have a <em>translation look-aside buffer (TLB)</em>, that is effectively a cache
of page entries, so the CPU does not have to constantly fetch page entries from
the PD and PT.
This is mostly transparent to the operating system, however the TLB should be
flushed when a page entry is changed that results in some form of more
restricted access compared to the previous state (relaxing access control
does not need a TLB flush, since the processor will load the entry again before
throwing a page fault).
The TLB can be flushed by writing to CR3.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Due to 32-bit addressing, a single segment can now span all of the 4 GiB
linear address space.
This means programs no longer need to be split into multiple segments, instead,
having a single flat segment starting at linear address zero, similar to the
tiny memory model.
Most modern operating systems on the x86 architecture employ this <strong>flat memory
model</strong> and use paging, rather than segmentation, as the primary mechanism for
virtual memory.
This means the GDT only contains a handful of actual segments and the LDT is
completely ignored.</p>
</div>
<div class="paragraph">
<p>In this scheme, each process has its own isolated linear address space.
This is facilitated by the fact that the TSS has an entry for CR3.
Another advantage of the two-level paging scheme is that common areas of
virtual memories can be mapped in only one set of page tables, that can be then
mapped in the page directory of each individual process, instead of each
process having a its own set of identical page tables for common areas of
virtual memory.</p>
</div>
<div class="paragraph">
<p>One disadvantage of paging is that it has less fine control over access
permissions.
Pages are aligned 4 kiB blocks, and effectively only have two privilege levels.
Many operating system, however, only use Ring 0 and Ring 3 anyways.
Another problem is that there is no way to restrict execution of pages, while
still allowing it to be read or written.</p>
</div>
<div class="paragraph">
<p>Modern operating systems implement <strong>software context switching</strong>, rather than
using the hardware context switching facilities.
Modern processors no longer optimize hardware context switching.
In particular, this means there is a fixed amount of task state segments,
meaning, in combination with the flat memory model, that modern operating
systems typically have a fixed amount of entries in the GDT.</p>
</div>
</div>
<div class="sect3">
<h4 id="_page_fault">3.4.4. Page fault</h4>
<div class="paragraph">
<p>The 386 introduces a new exception:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. New 386 exceptions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vector</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Error code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Page fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This new exception is special in certain regards:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Double exception handling is different.
If a page fault occurs during a contributory exception, the fault and
exception are handled serially.
However, if a contributory exception occurs during a page fault, a double
fault is raised.</p>
</li>
<li>
<p>The error code does not provide an entry in a segment descriptor table.
Instead, it consists of flags indicating the nature of the memory access that
caused the page fault.
CR2 stores the linear address that caused the page fault.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Page fault error code</caption>
<colgroup>
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="13"><p class="tableblock">Reserved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">W/R</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Present (P)</dt>
<dd>
<p>Zero for a fault caused by a non-present page; one for a
protection violation.</p>
</dd>
<dt class="hdlist1">Write/read flag (W/R)</dt>
<dd>
<p>Zero for a fault caused by a read; one for a fault
caused by a write.</p>
</dd>
<dt class="hdlist1">User/supervisor flag (U/S)</dt>
<dd>
<p>Zero for a fault caused by a process in user mode;
one for a fault caused by a process in supervisor
mode.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_control_registers">3.4.5. Control registers</h4>
<div class="paragraph">
<p>The 386 introduced eight 32-bit control registers CR0 to CR7, that can be
accessed through a regular <code>mov</code> instruction to or from a general-purpose
register.</p>
</div>
<div class="paragraph">
<p>CR0 is a 32-bit extension to the 16-bit MSW that adds two new flags:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Extension type (ET)</dt>
<dd>
<p>Zero for a 287; one for a 387.
The 386 automatically initializes this bit.</p>
</dd>
<dt class="hdlist1">Paging (PG)</dt>
<dd>
<p>Zero disables paging; one enables paging.
Must not be set, if PE is zero.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>CR1 and CR4 to CR7 are reserved for future use, and cause an undefined opcode
exception.</p>
</div>
<div class="paragraph">
<p>CR2 stores the linear address of the memory location that triggered a page
fault.</p>
</div>
<div class="paragraph">
<p>CR3 contains the Page Directory Base Table (PDBR), the physical address of
the page directory.
Since the page directory must be page-aligned, the lower 12 bits are reserved.</p>
</div>
</div>
<div class="sect3">
<h4 id="_debugging">3.4.6. Debugging</h4>
<div class="paragraph">
<p>Previous x86 CPUs already have certain debugging facilities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Interrupt 1, that is invoked on every instruction when the trap flag (TF) is
set.
This feature allows for single-stepping.</p>
</li>
<li>
<p>Interrupt 3, that can be invoked by the one-byte instruction <code>int3</code>, allowing
for breakpoints.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, the 386 introduces the ability to trap a task through a flag in
the TSS and to invoke interrupt 1 via the one-byte <code>int1</code> instruction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Intel reserves <code>int1</code> for hardware debugging, while software debuggers should
use <code>int3</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The 386 also introduces eight debug registers, DR0 to DR7, and corresponding
<code>mov</code> instruction.
DR4 and DR5 are reserved, and are aliases to DR6 and DR7 respectively.
DR0 to DR3 contain the linear address of breakpoints zero through three.
DR6 is known as the <em>Debug Status Register</em>, and DR7 is known as the <em>Debug
Control Register</em>.</p>
</div>
<div class="paragraph">
<p>DR7 controls under what circumstances the debug exceptions are dispatched:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>R/W0 to R/W3 specify the kind of breakpoint:</p>
</li>
<li>
<p><code>00</code> - Instruction breakpoint.
Range must be one byte (<code>00</code>).
Causes a fault just <em>before</em> a instruction that starts at the precise
linear address of the breakpoint is executed.</p>
</li>
<li>
<p><code>01</code> - Causes a trap (i.e. the interrupt is dispatched <em>after</em> the
instruction is executed) when memory in the range given by DR0 to DR3 and
LEN0 to LEN3 is written to.</p>
</li>
<li>
<p><code>10</code> - Reserved.</p>
</li>
<li>
<p><code>11</code> - Causes a trap when data is read or written to (see <code>01</code>).</p>
</li>
<li>
<p>The LEN0 to LEN3 fields control the range of bytes that are affected by a
data breakpoint.
The linear address must be aligned according to the range field (i.e. 2 byte
breakpoints must be word-aligned, 4 byte breakpoints must be dword-aligned).</p>
</li>
<li>
<p><code>00</code> - 1 byte</p>
</li>
<li>
<p><code>01</code> - 2 byte</p>
</li>
<li>
<p><code>10</code> - 8 byte (AMD long mode and certain Intel processors only; reserved
otherwise)</p>
</li>
<li>
<p><code>11</code> - 4 byte</p>
</li>
<li>
<p>G0 to G3 enable the respective breakpoint globally.</p>
</li>
<li>
<p>L0 to L3 enable the respective breakpoint locally.
This means they are reset automatically on a task switch.</p>
</li>
<li>
<p>GE and LE slow the processor down, so that data breakpoints happen on the
correct instruction.
LE is automatically cleared on a task switch.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>DR6 indicates the cause of a debug exception.
The fields are set automatically by the processor, but never reset.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>B0 to B3 indicate a fault or trap due to a breakpoint.</p>
</li>
<li>
<p>BT indicates a trap due to the T flag in a TSS.</p>
</li>
<li>
<p>BS indicates a single-step trap due to the trap flag TF.</p>
</li>
<li>
<p>BD indicates a "general detect fault" caused by reading or writing a debug
register.
This happens, when an in-circuit emulator (such as the ICE-386) is using the
debug registers.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Since instruction breakpoints are a fault, resuming the fault may cause the
breakpoint to happen again.
To deal with this, the <em>resume (or restart) flag (RF)</em> was introduced.
This flag is automatically set on the saved EFLAGS register, whenever any fault
occurs.
If RF is set, instruction breakpoints are disabled for one instruction, since
the flag is automatically cleared once an instruction finishes successfully.</p>
</div>
</div>
<div class="sect3">
<h4 id="_test_registers">3.4.7. Test registers</h4>
<div class="paragraph">
<p>In addition to control and debug registers, the 386 has a <code>mov</code> instruction for
eight test registers.
However, only TR6, the <em>test command register</em>, and TR7, the <em>test control
register</em>, exist.
These serve to test the TLB during early initialization.</p>
</div>
</div>
<div class="sect3">
<h4 id="_virtual_8086_mode_2">3.4.8. Virtual 8086 mode</h4>
<div class="paragraph">
<p>In order to allow real mode programs to run under protected mode, the 386
introduces <strong>virtual 8086 mode (VM86 mode)</strong>.
The processor is in VM86 mode if the <em>VM flag</em> in the EFLAGS register is set.</p>
</div>
<div class="paragraph">
<p>The VM flag can only be toggled through an <code>iret</code> in Ring 0 or a task switch,
in order to update the segment registers, the instruction pointer, and stack
pointer to a valid state (trying to change the VM flag through <code>popf</code> will not
result in a change of VM).
A task in VM86 mode is referred to as a <em>VM86 task</em>.
It runs under the supervision of a protected mode program called the <em>VM86
monitor</em>.</p>
</div>
<div class="paragraph">
<p>In VM86 mode, segmentation works in a similar way to real mode: the segment
base linear address is 16 times the segment selector value, and the limit is
always 65535.
The CPL in VM86 mode is always 3.</p>
</div>
<div class="paragraph">
<p>Paging, however, works as it does in protected mode.
In particular, the VM86 task can access the first mebibyte (plus 64 kiB minus
16 bytes) of linear address space, meaning that, if paging is enabled, this
memory does not have to be mapped to the first megabyte of memory, allowing
for multiple VM86 tasks.
Paging protection also applies, which allows the VM86 monitor to catch access
to certain memory areas.</p>
</div>
<div class="paragraph">
<p>The instructions that are sensitive to IOPL change in VM86 mode.
In particular, the I/O instructions <code>in</code>, <code>out</code>, <code>ins</code>, and <code>outs</code> are no
longer sensitive to IOPL, and <code>pushf</code>, <code>popf</code>, <code>iret</code>, and <code>int</code> (but not
<code>int3</code>, <code>into</code>, and <code>int1</code>) are now sensitive to IOPL.
<code>cli</code>, <code>sti</code>, and <code>lock</code> remain sensitive.
This means, if the IOPL is 3, the VM86 tasks may directly control the interrupt
flag, and may issue software interrupts directly, otherwise a general
protection fault is dispatched.</p>
</div>
<div class="paragraph">
<p>VM86 mode handles interrupts in a similar way to native protected mode.
The IDT is used, rather than the real mode IVT.
The corresponding IVT entry for an interrupt in VM86 mode must point to a
interrupt or trap gate pointing to a nonconforming code segment with
DPL 0, or a task gate.
If the resulting CPL of a interrupt or trap gate is not zero, a general
protection fault occurs.</p>
</div>
<div class="paragraph">
<p>When an interrupt causes a switch out of VM86 mode through an interrupt or trap
gate, in addition to updating CS:EIP (to the target of the gate) and SS:ESP
(with the SS0:ESP0 field of the current TSS), the other segment registers DS,
ES, FS, and GS are also pushed on the stack and set to null selectors, since
they contained real mode segment addresses, and not necessarily valid protected
mode segment selectors.</p>
</div>
<div class="paragraph">
<p>I/O permissions work much like protected mode, except that IOPL is ignored.
Instead, the I/O permission bitmap is always consulted, meaning the IOPL is
effectively zero.</p>
</div>
<details>
<summary class="title">32-bit call stack (ESP = -4 if error code, ESP = 0 otherwise)</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top" colspan="2">Call</th>
<th class="tableblock halign-left valign-top" colspan="2">Interrupt</th>
<th class="tableblock halign-left valign-top" colspan="2">Interrupt<br>
    from VM86 mode</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">+0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
<td class="tableblock halign-left valign-top" colspan="2" rowspan="5"></td>
<td class="tableblock halign-left valign-top" colspan="2" rowspan="4"></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">= SS0:ESP0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">(= SSn:ESPn)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ES</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">(= SSn:ESPn)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(SS)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(SS)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">(ESP)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">ESP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">(ESP)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">EFLAGS</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">EFLAGS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">EIP</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">EIP</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">EIP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-4</p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">(Error code)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">(Error code)</p></td>
</tr>
</tbody>
</table>
</div>
</details>
</div>
</div>
<div class="sect2">
<h3 id="_i486">3.5. i486</h3>
<div class="paragraph">
<p>The 486 expanded the 386 by introducing an integrated FPU and L1 cache.
486-class processors include the Cx486 and Am486, as well as the Am5x86 (but
not the Cx5x86).
It also introduced the <code>cmpxchg</code> and <code>xadd</code> instructions, that are useful for
synchronization, and <code>bswap</code> to convert between big and little endian.
New mechanisms that allow finer control of caching were also introduced.</p>
</div>
<details>
<summary class="title">486 registers</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.5714%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8585%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Register</th>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EAX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EAX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AH (AX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AL (AX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(ECX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CH (CX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CL (CX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EDX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EDX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DH (DX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DL (DX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EBX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BH (BX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BL (BX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(ESP)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EBP)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">BP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESI</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(ESI)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EDI</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EDI)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EIP)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EFLAGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NT</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">IOPL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NW</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AM</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>WP</strong></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR2</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Page fault linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR3</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">Page Directory Base Register (PDBR)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PCD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PWT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR0</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 0 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR1</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 1 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR2</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 2 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR3</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 3 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR7</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">LEN3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">R/W3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">LEN2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">R/W2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">LEN1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">R/W1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">LEN0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">R/W0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ES<sup class="footnote">[<a id="_footnoteref_21" class="footnote" href="#_footnotedef_21" title="View footnote.">21</a>]</sup></p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">ES (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="14"><p class="tableblock">(visible CS selector)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">CPL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="14"><p class="tableblock">(visible SS selector)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">CPL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">FS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">GS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TR</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">TR (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDTR</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">LDTR (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">GDTR</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Base</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">IDR</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Base</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
</tbody>
</table>
</div>
</details>
<div class="paragraph">
<p>Since the FPU is now integrated, numeric exceptions can be routed internally to
interrupt 16.
However, to maintain compatibility with older implementations where the FPU is
external and the exception can be routed through another interrupt, the 486 has
the option to route the exception externally over the motherboard.
The <em>numeric error (NE)</em> bit in CR0 has to be set to enable the native
mechanism.</p>
</div>
<div class="paragraph">
<p>The 486 also introduces a feature to enforce aligned data access.
The alignment check happens when the <em>alignment check (AC)</em> flag in EFLAGS
<em>and</em> the <em>alignment mask (AM)</em> bit in CR0 are set <em>and</em> if the processor is in
Ring 3.
When a alignment violation happens, the an alignment check fault is raised.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. New 486 exceptions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vector</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Error code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alignment check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes<sup class="footnote">[<a id="_footnoteref_22" class="footnote" href="#_footnotedef_22" title="View footnote.">22</a>]</sup></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_cache_control">3.5.1. Cache control</h4>
<div class="paragraph">
<p>The new <code>invd</code> and <code>wbinvd</code> instruction invalidate the cache.
While the <code>invd</code> instruction may cause data loss on a writethrough cache, due
to not writing back changes, the <code>wbinvd</code> updates the memory with changes,
before invalidating the cache.</p>
</div>
<div class="paragraph">
<p>The <code>invlpg</code> instruction lets the operating system invalidate an individual TLB
entry, rather than invalidating all of them through writing to CR3.</p>
</div>
<div class="paragraph">
<p>The 486 also expanded the test registers of the 386.
In addition to TR6 and TR7, the 486 introduced TR3 (the <em>cache test data
register</em>), TR4 (the <em>cache test status register</em>) and TR5 (the <em>cache test
control register</em>), to test the internal writethrough L1 cache.</p>
</div>
<div class="paragraph">
<p>Two new flags were added to CR0 for global cache control:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Cache disable (CD)</em> disables the allocation of new cache lines, meaning read
cache misses are read directly from main memory, but no cache line gets
replaced.
To completely disable the cache, the CD bit is set and the cache is flushed
through <code>wbinvd</code>.
On CPUs with MTRR (see MTRR section), the memory type may need to be set to
uncacheable (UC) when setting the CD, in order to preserve strong memory
ordering (which can be done by disabling MTRRs).</p>
</li>
<li>
<p><em>No writethrough (NW)</em> may only be set if CD is also set and causes cache
coherence to no longer be maintained, i.e. write cache misses are written to
the cache and never written back to main memory.
On P6 processors and later, setting the NW bit disables writeback caching,
forcing pages to writethrough, regardless of PWT (see below) and MTTRs
(see MTRR section).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Having NW one and CD zero is invalid and causes a general protection fault.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The effect of the CD and NW bits varies over implementations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The NW bit does not exist on Cx486 processors.</p>
</li>
<li>
<p>The NW bit has a different meaning on Cx5x86, 6x86, MII, and MediaGX
processors.</p>
</li>
<li>
<p>The NW bit is ignored on Intel Pentium 4 and later, as well as any AMD64
implementation.</p>
</li>
<li>
<p>The CD bit disables caching completely on Intel Atom CPUs.</p>
</li>
<li>
<p>If the CD bit is set, 64-bit AMD processors automatically invalidate (and
write back) a cache line on a cache hit.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_paging_2">3.5.2. Paging</h4>
<div class="paragraph">
<p>If the new <em>write protect (WP)</em> bit in CR0 is set, writing to a read-only page
will cause a page fault, even in supervisor mode.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. 486 page entries</caption>
<colgroup>
<col style="width: 8.5714%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8585%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entry type</th>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR3</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">PD physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PCD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PWT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDE</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">PT physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PCD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PWT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PTE</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">Page physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PCD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PWT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Page-level cache disable (PCD)</dt>
<dd>
<p>Disables caching for this page.
This bit (as well as the PWT bit) is present
in CR3, PDEs, and PTEs.
CR3 controls caching for the PD, the PDE
controls caching for the PT, and the PTE
controls caching for the page.</p>
</dd>
<dt class="hdlist1">Page-level writethrough (PWT)</dt>
<dd>
<p>Disables any writeback cache for this page
(in particular external ones, the 486 has an
internal writethrough cache).
See PCD.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_i586">3.6. i586</h3>
<div class="paragraph">
<p>586-class processors include the Intel Pentium and Pentium MMX, the AMD K5, the
NexGen Nx586, as well as the Cyrix Cx5x86, Cx6x86 and MediaGX.
In addition to adding the <code>cmpxchg8b</code> and <code>cpuid</code> instructions, the Pentium
introduced MSRs, machine checks, and the TSC, along with extensions to paging,
virtual 8086 mode, and debugging.
The Pentium introduces CR4 to control processor extensions.</p>
</div>
<details>
<summary class="title">IA-32 registers</summary>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 8.5714%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8585%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Register</th>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EAX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EAX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AH (AX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">AL (AX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ECX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(ECX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CH (CX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">CL (CX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EDX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EDX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DH (DX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">DL (DX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBX</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EBX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BH (BX)</p></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">BL (BX)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(ESP)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EBP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EBP)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">BP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESI</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(ESI)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">SI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EDI</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EDI)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EIP</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">(EIP)</p></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EFLAGS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>VIP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>VIF</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NT</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">IOPL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PF</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NW</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AM</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WP</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR2</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Page fault linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR3</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">Page Directory Base Register (PDBR)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OS<br>
  XMM<br>
  EX<br>
  CPT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OS<br>
  FX<br>
  SR</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PCE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PGE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MCE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PAE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PSE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TSD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PVI</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>VME</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR0</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 0 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR1</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 1 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR2</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 2 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR3</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Breakpoint 3 linear address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DR7</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">LEN3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">R/W3</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">LEN2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">R/W2</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">LEN1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">R/W1</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">LEN0</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">R/W0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>GD</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">G0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ES<sup class="footnote">[<a id="_footnoteref_23" class="footnote" href="#_footnotedef_23" title="View footnote.">23</a>]</sup></p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">ES (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="14"><p class="tableblock">(visible CS selector)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">CPL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="14"><p class="tableblock">(visible SS selector)</p></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">CPL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">DS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">FS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GS</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">GS (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TR</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">TR (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDTR</p></td>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">LDTR (visible selector)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">GDTR</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Base</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">IDR</p></td>
<td class="tableblock halign-left valign-top" colspan="32"><p class="tableblock">Base</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="16"></td>
<td class="tableblock halign-left valign-top" colspan="16"><p class="tableblock">Limit</p></td>
</tr>
</tbody>
</table>
</div>
</details>
<div class="dlist">
<dl>
<dt class="hdlist1">Virtual interrupt flag (VIF)</dt>
<dd>
<p>See VME.</p>
</dd>
<dt class="hdlist1">Virtual interrupt pending (VIP)</dt>
<dd>
<p>See VME.</p>
</dd>
<dt class="hdlist1">ID flag</dt>
<dd>
<p>The ability to toggle this flag indicates the presence of <code>cpuid</code>.</p>
</dd>
<dt class="hdlist1">General detect (GD)</dt>
<dd>
<p>Setting this bit causes a debug fault whenever the debug
registers are accessed (see debugging extensions).</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_cpuid">3.6.1. CPUID</h4>
<div class="paragraph">
<p>Pentium and late 486 models support the <code>cpuid</code> instruction, in order to
facilitate the detection of CPU models.
The ability to toggle the <em>ID flag</em> in EFLAGS indicates the presence of the
<code>cpuid</code> instruction.</p>
</div>
<div class="paragraph">
<p><code>cpuid</code> returns a variety of information in EAX, EBX, ECX and EDX,
based on the initial value of EAX, the <em>function number</em>.
There are standard function numbers, starting from 0x00000000, and extended
function numbers, starting from 0x80000000.</p>
</div>
<div class="paragraph">
<p>Important functions include:<sup class="footnote">[<a id="_footnoteref_24" class="footnote" href="#_footnotedef_24" title="View footnote.">24</a>]</sup></p>
</div>
<div class="ulist">
<ul>
<li>
<p>EAX = 0x00000000 returns the highest standard function number in EAX and
a 12 byte vendor string in EBX, ECX, and EDX.
The vendor string is "GenuineIntel" for Intel processors, and "AuthenticAMD"
for AMD processors.</p>
</li>
<li>
<p>EAX = 0x80000000 returns the highest extended function number in EAX.</p>
</li>
<li>
<p>EAX = 0x00000001 returns version information in EAX and feature bits in EDX
and ECX.</p>
</li>
<li>
<p>EAX = 0x80000001 returns provides more feature bits in EDX and ECX.</p>
</li>
<li>
<p>EAX = 0x00000007 provides subfunctions based on the value of ECX:</p>
</li>
<li>
<p>ECX = 0 returns the highest subfunction number in EAX.
EBX, ECX and EDX contain even more feature bits.</p>
</li>
<li>
<p>ECX = 1 returns a further set of feature bits in EAX and EBX.</p>
</li>
<li>
<p>EAX = 0x80000002, 0x80000003, 0x80000004 return part of the processor brand
string in EAX, EBX, ECX, and EDX.
The entire string is therefore 48 bytes long.</p>
</li>
<li>
<p>EAX = 8x00000008 returns the physical address width in AL and the linear
address width in AH.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There exist many other functions that might be relevant to operating system
development, such as information on multiprocessor topology.
The feature bits are used to indicate the presence of a certain processor
extension.
They are generally set if the processor extension is present and cleared if it
is not preset (see the extensions section for more detailed information).</p>
</div>
<div class="paragraph">
<p>The version information consists of a family, model and stepping ID.
If the family ID field is 15, then the extended family ID field is added to the
family field to obtain the actual processor family number.
If the family ID field is 6<sup class="footnote">[<a id="_footnoteref_25" class="footnote" href="#_footnotedef_25" title="View footnote.">25</a>]</sup> or 15, the model number is
the extended model ID times 16 plus the model ID.</p>
</div>
<div class="paragraph">
<p>The processor type is 0 for a regular processor, 1 for a Pentium OverDrive and
2 for a second processor.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. CPUID version information</caption>
<colgroup>
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"></td>
<td class="tableblock halign-left valign-top" colspan="8"><p class="tableblock">Extended family</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Extended model</p></td>
<td class="tableblock halign-left valign-top" colspan="2"></td>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">Type<sup class="footnote">[<a id="_footnoteref_26" class="footnote" href="#_footnotedef_26" title="View footnote.">26</a>]</sup></p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Family</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Model</p></td>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Stepping</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>It is recommended to check for extensions using the feature bits when possible,
rather than based on family and model.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_i686">3.7. i686</h3>
<div class="paragraph">
<p>686-class processors include the Intel Pentium Pro, Pentium II and Pentium III,
as well as the AMD K6, K6-2 and K6-III.
The term 686 is ambiguous and may refer to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Intel Family 6 processors, which include the Pentium Pro, II and III, as well
as modern Core 2, i3, i5 and i7 branded processors, but not earlier
NetBurst-based processors, such as the Pentium 4.</p>
</li>
<li>
<p>All 32-bit processors supporting the Pentium Pro instruction set,
which would include 32-bit NetBurst-based processors, but not later 64-bit
processors.</p>
</li>
<li>
<p>All 32-bit processors supporting the Pentium Pro instruction set, but not
supporting SSE2, which would exclude NetBurst-based processors, but include
the K7 Athlon.</p>
</li>
<li>
<p>Sixth generation x86 processors, which would exclude NetBurst-based
processors as well as the K7 Athlon.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_i786">3.8. i786</h3>
<div class="paragraph">
<p>The term "786" may refer to different things:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>x86-64 processors.</p>
</li>
<li>
<p>Processors with SSE2, which would include the Pentium 4 and Athlon 64.</p>
</li>
<li>
<p>Seventh-generation microarchitectures, which would include NetBurst and K7.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_x86_64_2">3.9. x86-64</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_extensions">4. Extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>New features that were introduced after the 486 are usually processor
extensions, whose presence can be directly and separately determined via
<code>cpuid</code>.
There are exceptions, however, such as <code>ud2</code>, long <code>nop</code>, and <code>rdpmc</code> (along
with the corresponding PCE flag), whose presence are not indicated by any
feature bit.</p>
</div>
<div class="sect2">
<h3 id="_model_specific_registers">4.1. Model-specific registers</h3>
<div class="paragraph">
<p>The Pentium and subsequent processors no longer have the test registers of the
386 and 486.
Instead, it introduces <strong>model-specific registers (MSRs)</strong>.
MSRs are 64-bit registers that are addressed using a 32-bit number and are
accessed via the Ring 0-only <code>rdmsr</code> and <code>wrmsr</code> instructions.</p>
</div>
<div class="paragraph">
<p>The first two MSRs are related to the <strong>machine-check architecture</strong>.
The machine-checks are model-specific exceptions that usually indicate critical
errors.
Information on a machine-check exception is available in relevant MSRs,
although the details have changed with P6-based processors and later.
Machine-checks are enabled when the <em>machine-check enable (MCE)</em> bit of CR4 is
set.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. New Pentium exceptions</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vector</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-left valign-top">Error code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine-check</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Benign</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The Pentium also introduces the <em>time stamp counter (TSC)</em> MSR, that can be
read in user mode through the <code>rdtsc</code> instruction.
Setting the <em>time stamp disable (TSD)</em> bit of CR4 restricts <code>rdtsc</code> to Ring 0.</p>
</div>
<div class="paragraph">
<p>The later Pentium MMX variant, in addition to introducing MMX, includes the
<code>rdpmc</code> instruction from the Pentium Pro to read so-called
<em>performance-monitoring counters (PMCs)</em> MSRs.
This instruction can be executed in user mode, by setting the
<em>performance-monitoring counter enable (PCE)</em> bit of CR4.</p>
</div>
</div>
<div class="sect2">
<h3 id="_page_size_extensions">4.2. Page size extensions</h3>
<div class="paragraph">
<p>The <strong>Page Size Extensions (PSE)</strong> are enabled through the PSE bit of CR4.
PSE introduces a new bit in PDEs, that allows for 4 MiB pages, rather
than a PT with 1024 4 kiB pages.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. PSE page entries</caption>
<colgroup>
<col style="width: 8.5714%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8585%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entry type</th>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR3</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">PD physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDE</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">PT physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDE</p></td>
<td class="tableblock halign-left valign-top" colspan="10"><p class="tableblock">4 MiB page physical address (31:22)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PTE</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">4 kiB page physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Page size (PS)</dt>
<dd>
<p>PD only.
Zero for 4 kiB pages; one for 4 MiB pages.</p>
</dd>
<dt class="hdlist1">Dirty bit (D)</dt>
<dd>
<p>Exists in PDEs for 4 MiB pages.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>4 MiB pages must be 4 MiB aligned, therefore bits 12 to 21 are reserved.</p>
</div>
</div>
<div class="sect2">
<h3 id="_virtual_8086_mode_extensions">4.3. Virtual 8086 mode extensions</h3>
<div class="paragraph">
<p><strong>Virtual Mode Extensions (VME)</strong> allow for interrupt handling inside virtual
8086 mode, without switching to protected mode, thereby increasing performance.
It is enabled by setting the VME bit in CR4.</p>
</div>
<div class="paragraph">
<p>With VME enabled, software interrupts caused by the <code>int</code> instruction (but not
<code>int3</code>, <code>into</code> and <code>int1</code>) may be handled by handlers in virtual 8086 mode,
using the real-mode IVT at linear address zero.
A 32-byte bitmap (one bit for every interrupt vector), that is located just
below the I/O permission bitmap (i.e. the base of the interrupt redirection
bitmap is the I/O map base minus 32) in the TSS is, is used to determine how a
software interrupt is dispatched.</p>
</div>
<div class="paragraph">
<p>If the bit corresponding to the interrupt vector is set, the interrupt is
handled in protected mode using the IDT (or causes a general protection fault,
if the IOPL is not 3).
If the bit is cleared, the interrupt is handled in virtual 8086 mode, as if it
is a real mode interrupt (the IOPL field of the pushed FLAGS register is always
set to 3).
Hardware interrupts and exceptions, however, are always handled through
protected mode interrupt handlers.</p>
</div>
<div class="paragraph">
<p>VME also introduces the <em>virtual interrupt flag (VIF)</em> and the <em>virtual
interrupt pending (VIP)</em> flag, for the VM86 task to be able to prevent
asynchronous hardware interrupts affecting its state, without disabling
hardware interrupts for all tasks or causing a fault (meaning a costly switch
to protected mode).
When VME is enabled and the IOPL is less than 3, <code>cli</code>, <code>sti</code>, <code>popf</code> and
<code>iret</code> will not update the interrupt flag IF (nor cause a general protection
fault), rather it will update VIF.
<code>pushf</code> and a <code>int</code> to a virtual 8086 mode handler (i.e. with the corresponding
bit in the bitmap cleared) will store VIF, rather than IF, when pushing the
FLAGS register.</p>
</div>
<div class="paragraph">
<p>Having VIF and VIP set simultaneously in VM86 mode (such as running <code>sti</code>
virtual 8086 mode while VIP is set) will cause a general protection fault.
This means when a hardware interrupt occurs, the protected mode handler can
check the VIF flag.
If it is cleared, the VM86 task does not expect hardware interrupts, and the
VM86 monitor can set the VIP flag and return to the VM86 task.
When the VM86 task sets the IF flag, it will transparently set the VIF flag
instead, and cause a general protection fault, due to the VIP flag also being
set.
The VM86 monitor can then handle the hardware interrupt belatedly and clear the
VIP flag and set the VIF flag and return.</p>
</div>
<div class="paragraph">
<p>The <em>protected mode virtual interrupts (PVI)</em> bit of CR4 enables the VIF and
VIP mechanism for protected mode.
If the PVI bit is set, the CPL is 3 and the IOPL is less than 3, the <code>cli</code> and
<code>sti</code> instructions (<code>pushf</code>, <code>popf</code>, <code>int</code> and <code>iret</code> are not affected) will
change the VIF flag, rather than the IF flag.
As in VM86, having VIF and VIP set simultaneously causes a general protection
fault.
Therefore, the handling of maskable hardware interrupts and also be delayed, as
with VM86 mode, at the request of user mode software.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
VIF and VIP, like VM, cannot be directly changed through <code>popf</code> and can only be
changed through a <code>iret</code> in Ring 0 or a <code>popf</code> in Ring 1.
VIF can be indirectly changed in Ring 3 by attempting to change IF, if VME is
set in VM86 mode or if PVI is set in native protected mode.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_debugging_extensions">4.4. Debugging extensions</h3>
<div class="paragraph">
<p>The functionality of the debug registers was extended in the Pentium in three
ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DR7 now has the <em>general detect (GD)</em> bit, which allows software to enable
general detect exceptions (debug fault when a debug register is accessed).
This serves to prevent software interfering with emulators that use the debug
registers.
The GD bit is cleared automatically on a general detect exception.</p>
</li>
<li>
<p>The R/W0 to R/W3 fields now allow for the <code>10</code> value, which was previously
reserved.
The <code>10</code> value sets an I/O breakpoint (same alignment requirements as data
break point).</p>
</li>
<li>
<p>The <em>debug extensions (DE)</em> bit of CR4, which disables the aliasing of DR4
and DR5 to DR6 and DR7 when set.
If this bit is set, reading or writing to DR4 and DR5 cause an invalid opcode
exception, similar to CR1.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_pge">4.5. PGE</h3>
<div class="paragraph">
<p>Setting the <strong>page global enable (PGE)</strong> bit in CR4 enables the a new bit in page
entries, that allows operating systems to mark regions of linear address space
that are common to all processes (and therefore global).
The CPU will not flush global pages when swapping address space (i.e. updating
CR3), increasing TLB efficiency.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. PGE page entries (with PSE)</caption>
<colgroup>
<col style="width: 8.5714%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8571%;">
<col style="width: 2.8585%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Entry type</th>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CR3</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">PD physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDE</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">PT physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDE</p></td>
<td class="tableblock halign-left valign-top" colspan="10"><p class="tableblock">4 MiB page physical address (31:22)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>G</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PTE</p></td>
<td class="tableblock halign-left valign-top" colspan="20"><p class="tableblock">4 kiB page physical address (31:12)</p></td>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>G</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U/S</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R/W</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Global (G)</dt>
<dd>
<p>If set, the CPU will not flush this page from the TLB when
updating CR3.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_pae">4.6. PAE</h3>
<div class="paragraph">
<p>The Pentium Pro extended the physical address space to 36-bit.
This allows for up to 64 GiB of RAM.
In order to access this new memory, a new paging mechanism is introduced,
<strong>Physical Address Extension (PAE)</strong>, which allows pages to be mapped above 4
GiB.
PAE is transparent to application programs and the linear address space is
still restricted to 4 GiB.</p>
</div>
<div class="paragraph">
<p>PAE is enabled by the PAE bit in CR4 and modifies paging by increasing the size
of page entries to 64-bit, meaning that a page table now can only hold 512 page
entries, rather than 1024.
This means a third level is introduced, the <strong>page directory pointer table
(PDPT)</strong>.
This table contains four <em>page directory pointer table entries (PDPTEs)</em> to
four PDs, each covering 1 GiB of linear address space and containing 512
entries to PDs, each covering 2 MiB of linear address space and containing 512
entries to 4 kiB pages.</p>
</div>
<div class="paragraph">
<p>The upper part of the linear address is known as the <em>page directory pointer
table index (PDPTI)</em>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. PAE linear address</caption>
<colgroup>
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
<col style="width: 3.125%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">31</th>
<th class="tableblock halign-left valign-top">30</th>
<th class="tableblock halign-left valign-top">29</th>
<th class="tableblock halign-left valign-top">28</th>
<th class="tableblock halign-left valign-top">27</th>
<th class="tableblock halign-left valign-top">26</th>
<th class="tableblock halign-left valign-top">25</th>
<th class="tableblock halign-left valign-top">24</th>
<th class="tableblock halign-left valign-top">23</th>
<th class="tableblock halign-left valign-top">22</th>
<th class="tableblock halign-left valign-top">21</th>
<th class="tableblock halign-left valign-top">20</th>
<th class="tableblock halign-left valign-top">19</th>
<th class="tableblock halign-left valign-top">18</th>
<th class="tableblock halign-left valign-top">17</th>
<th class="tableblock halign-left valign-top">16</th>
<th class="tableblock halign-left valign-top">15</th>
<th class="tableblock halign-left valign-top">14</th>
<th class="tableblock halign-left valign-top">13</th>
<th class="tableblock halign-left valign-top">12</th>
<th class="tableblock halign-left valign-top">11</th>
<th class="tableblock halign-left valign-top">10</th>
<th class="tableblock halign-left valign-top">9</th>
<th class="tableblock halign-left valign-top">8</th>
<th class="tableblock halign-left valign-top">7</th>
<th class="tableblock halign-left valign-top">6</th>
<th class="tableblock halign-left valign-top">5</th>
<th class="tableblock halign-left valign-top">4</th>
<th class="tableblock halign-left valign-top">3</th>
<th class="tableblock halign-left valign-top">2</th>
<th class="tableblock halign-left valign-top">1</th>
<th class="tableblock halign-left valign-top">0</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">PDPTI</p></td>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock">PDI (0-511)</p></td>
<td class="tableblock halign-left valign-top" colspan="9"><p class="tableblock">PTI (0-511)</p></td>
<td class="tableblock halign-left valign-top" colspan="12"><p class="tableblock">Offset (0-4095)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>PAE allows for large pages, that are 2 MiB in size, rather than 4 MiB,
regardless of the state of the PSE bit.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_floating_point_and_vector_extensions">5. Floating-point and vector extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>x86 processors have a plethora of extensions, that expand on the
general-purpose instruction set.</p>
</div>
<div class="sect2">
<h3 id="_x87">5.1. x87</h3>
<div class="paragraph">
<p><strong>x87</strong>, also known as <em>Numerical Processing Extension (NPX)</em> or <em>FPU</em>, is a
scalar floating-point calculation extension.
Units that implement x87 are often referred to as "the FPU", although the term
may also apply to the SIMD floating-point extensions listed below.
Originally implemented as a separate coprocessor, it is integrated into the
486DX and most processors that came after it.</p>
</div>
<div class="paragraph">
<p>The instruction set primarily operates on a stack of eight 80-bit registers
that are addressed as ST(0) to ST(7) relative to the top of the stack.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mmx">5.2. MMX</h3>
<div class="paragraph">
<p><strong>Multimedia Extensions (MMX)</strong>, introduced in 1997 with the Pentium MMX, is a
SIMD (single instruction; multiple data) extension.
AMD first implemented MMX in the K6 in 1997.
MMX only supported integer math and operated on aliases to the 64-bit
significand part of the x87 registers, called MM0 to MM7.
Unlike x87, MMX addresses those registers directly, without a stack pointer.
This aliasing makes it difficult for applications to use MMX and x87 at the
same time.</p>
</div>
<div class="sect3">
<h4 id="_3dnow">5.2.1. 3DNow!</h4>
<div class="paragraph">
<p>In 1998, AMD introduced <strong>3DNow!</strong> with the K6-2.
This extended MMX to introduce support for operations on 32-bit floating-point
data.
AMD introduced an extended version of 3DNow! in 1999 with the original Athlon.
This also includes a subset of new MMX integer instructions introduced with
SEE.
Starting with AMD Bulldozer CPUs, 3DNow! is no longer supported (except for two
instructions that are also found in newer Intel processors).</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sse">5.3. SSE</h3>
<div class="paragraph">
<p><strong>Streaming SIMD Extensions (SSE)</strong>, also known as <em>Katmai New Instructions
(KNI)</em> or <em>Internet Streaming SIMD Extensions (ISSE)</em>, is a SIMD extension,
introduced in 1999 with the Intel Pentium III, and supported by AMD since the
Athlon XP in 2001.
In addition to adding new instructions to the existing MMX integer instruction
set, it introduces a new set of eight 128-bit registers, XMM0 to XMM7, that can
each store four 32-bit floating-point numbers.</p>
</div>
<div class="sect3">
<h4 id="_sse2">5.3.1. SSE2</h4>
<div class="paragraph">
<p><strong>SSE2</strong>, also known as <em>Willamette New Instructions (WNI)</em>, was introduced in
2000 with the Intel Pentium 4.
AMD first implemented it with the x86-64 Opteron in 2003.
SSE2 adds support for 64-bit floating-point numbers and integers of sizes
ranging from 8-bit to 64-bit, through MMX-like instructions on SSE registers.
Thus, it is a full replacement of MMX and a partial replacement for x87 (though
x87 supports higher precision 80-bit floating-point math).</p>
</div>
<div class="paragraph">
<p>AMD’s x86-64 implementation introduced eight new registers, XMM8 to XMM15,
that can only be used in 64-bit mode.
In fact, SSE2 with 16 registers is mandatory for every x86-64 implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sse3">5.3.2. SSE3</h4>
<div class="paragraph">
<p><strong>SSE3</strong>, also known as <em>Prescott New Instructions (PNI)</em>, was introduced by
Intel in 2004 with the Prescott Pentium 4, and by AMD in 2005 with the Athlon
XP Revision E.
This extension introduces support for "horizontal" operations between values in
the same register.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ssse3">5.3.3. SSSE3</h4>
<div class="paragraph">
<p><strong>Supplementary Streaming SMD Extenions 3 (SSSE3)</strong>, also known as <em>Merom New
Instructions (MNI)</em>, was first implemented by Intel in 2006 with Woodcrest
Xeons, and by AMD with Bulldozer AMD FX CPUs in 2011.
It is not to be confused with SSE4.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sse4">5.3.4. SSE4</h4>
<div class="paragraph">
<p><strong>SSE4</strong> is divided into two subsets by Intel.
The first subset, <strong>SSE4.1</strong>, also known as <em>Penryn New Instructions (PNI)</em>, was
introduced with Penryn Core 2 CPUs in 2007.
The second subset, <strong>SSE4.2</strong>, also known as <em>String and Text New Instructions
(STTNI)</em>, was introduced with Nehalem Core i7 CPUs in 2008.
Nehalem also introduces performance improvements for misaligned data.
While SSE4.1 adds new SIMD instructions, such as a dot product instruction,
SSE4.2 adds string search and comparison instructions, and a CRC32 instruction.</p>
</div>
<div class="paragraph">
<p>AMD introduced its own subset of SSE4, <strong>SSE4A</strong>, with the K10 in 2007.
SSE4A introduces four instructions not available on any Intel processor.
AMD started supporting the full SSE4 instruction set with the Bulldozer
architecture in 2011.
With SSE4A, AMD also introduced greater support for operations with misaligned
data, which is supported by Intel since AVX.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sse5">5.3.5. SSE5</h4>
<div class="paragraph">
<p><strong>SSE5</strong> is a proposed extension by AMD in 2007.
It does not include all SSE4 instructions, and proposes a new <em>DREX encoding</em>,
which is incompatible with AVX’s VEX encoding.
This extension was never implemented in hardware. having to be revised and
split into F16C, XOP and FMA4 in 2009, in order to remain compatible with AVX.</p>
</div>
</div>
<div class="sect3">
<h4 id="_f16c">5.3.6. F16C</h4>
<div class="paragraph">
<p><strong>F16C</strong>, also known as <strong>CVT16</strong>, originally proposed by AMD in 2009, adds
instructions to convert between half-precision and single-precision
floating-point numbers.
It was first implemented by AMD with Bulldozer in 2011, and by Intel with Ivy
Bridge in 2012.</p>
</div>
</div>
<div class="sect3">
<h4 id="_xop">5.3.7. XOP</h4>
<div class="paragraph">
<p><strong>Extended Operations (XOP)</strong> adds new vector instructions to SSE, was first
proposed by AMD in 2015, and first implemented in Bulldozer in 2011.
XOP does not use the VEX coding scheme of AVX, instead using its own.
No Intel CPU implemented XOP, and AMD dropped support with Zen in 2017.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fma">5.3.8. FMA</h4>
<div class="paragraph">
<p>There exist two variants of <strong>Fused Multiply-Add (FMA)</strong>: the three-operand
<strong>FMA3</strong> and the four-operand <strong>FMA4</strong>.
The original instructions in SSE5 were three-operand DREX-encoded.
Intel’s original AVX specification specified a VEX-encoded four-operand
version (FMA4).
Later, Intel changed it to a three-operand VEX-encoded version (FMA3).</p>
</div>
<div class="paragraph">
<p>AMD first implemented FMA4 with Bulldozer in 2011, and FMA3 with Piledriver in
2012.
Intel never implemented FMA4, and implemented FMA3 with Haswell in 2013.
AMD dropped official support for FMA4 with Zen in 2017.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_avx">5.4. AVX</h3>
<div class="paragraph">
<p><strong>Advanced Vector Extensions (AVX)</strong> was first proposed by Intel in 2008, and
implemented in 2011 by Intel with Sandy Bridge, and by AMD with Bulldozer.
It introduces the new <em>VEX instruction coding</em> scheme, and expands the 128-bit
XMM SSE registers to 256-bit YMM registers (YMM0 to YMM15).
The VEX coding scheme allows three-operand operations, relaxes alignment
requirements, and allows 128-bit operations.</p>
</div>
<div class="sect3">
<h4 id="_avx2">5.4.1. AVX2</h4>
<div class="paragraph">
<p><strong>AVX2</strong> is an extension to AVX introduced by Intel in 2013 with Haswell, and by
AMD in 2015 with Excavator.</p>
</div>
</div>
<div class="sect3">
<h4 id="_avx_512">5.4.2. AVX-512</h4>
<div class="paragraph">
<p><strong>AVX-512</strong> is a set of extensions first proposed by Intel in 2013, and first
implemented in 2015.
AVX-512 consists of multiple instruction sets, with only <em>AVX-512F</em> (Foundation)
being mandatory.
AVX-512 expands the 256-bit AVX registers to 512-bit registers, and introduces
the new <em>EVEX coding scheme</em>, allowing for 32 registers (ZMM0 to ZMM31).
The <em>AVX-512VL</em> (vector length) set allows the use of AVX-512 operations on
256-bit (YMM0 to YMM31) and 128-bit (XMM0 to XMM31) operands.</p>
</div>
</div>
<div class="sect3">
<h4 id="_avx_vnni">5.4.3. AVX-VNNI</h4>
<div class="paragraph">
<p><strong>AVX-VNNI</strong> allows for <em>AVX-512VNNI</em> (virtual neural network interface)
instructions on 128-bit and 256-bit operands using the VEX encoding, for CPUs
that do not yet fully support AVX-512.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bit_manipulation_extensions">6. Bit manipulation extensions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Newer x86 implementations support non-SIMD <strong>bit manipulation instructions sets
(BMIs)</strong>, that operate on general-purpose registers.</p>
</div>
<div class="sect2">
<h3 id="_abm">6.1. ABM</h3>
<div class="paragraph">
<p><strong>Advanced Bit Manipulation (ABM)</strong> consists of the instructions <code>popcnt</code> and
<code>lzcnt</code>, and was introduced by AMD with SSE4A.
Intel introduced <code>popcnt</code> as part of SSE4.2 and <code>lzcnt</code> as part of BMI1.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bmi1">6.2. BMI1</h3>
<div class="paragraph">
<p><strong>Bit Manipulation Instruction Set 1 (BMI1)</strong> was introduced by AMD with
Piledriver in 2012, and implemented by Intel with Haswell in 2013.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tbm">6.3. TBM</h3>
<div class="paragraph">
<p><strong>Trailing Bit Manipulation (TBM)</strong> was introduced by AMD with Piledriver in
2012, and was never implemented by Intel.
Zen-based processors do not support TBM.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bmi2">6.4. BMI2</h3>
<div class="paragraph">
<p><strong>Bit Manipulation Instruction Set 2 (BMI2)</strong> was introduced by Intel with
Haswell in 2013, and supported by AMD since Excavator in 2015.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adx">6.5. ADX</h3>
<div class="paragraph">
<p><strong>Multi-Precision Add-Carry Instruction Extensions (ADX)</strong> is an extension
introduced by Intel with Broadwell in 2014, and supported by AMD since Zen in
2017.
It introduces instructions for the efficient adding of large integers.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_external_links">7. External links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/X86">x86 on Wikipedia</a></p>
</li>
</ul>
</div>
</div>
</div>

<div id="footnotes">
  <hr>
  <ul>
  
    <li class="footnote" id="_footnotedef_1">
      1. Early 486SX chips are actually 486DX chips with the FPU disabled.
    </li>
  
    <li class="footnote" id="_footnotedef_2">
      2. The 487SX is actually a full 486DX, that disables the 486SX completely.
    </li>
  
    <li class="footnote" id="_footnotedef_3">
      3. As is convention elsewhere, a byte is an 8-bit value and a nibble is a 4-bit value.
    </li>
  
    <li class="footnote" id="_footnotedef_4">
      4. The encoding for displacement zero is used to indicate   a direct offset.   This means <code>[bp]</code> is encoded as <code>[bp+0]</code>, and is not shorter than <code>[bp+1]</code>   (e.g. the encoding for <code>[si+0]</code> is shorter than <code>[si+1]</code>).
    </li>
  
    <li class="footnote" id="_footnotedef_5">
      5. As in: direct memory reference.
    </li>
  
    <li class="footnote" id="_footnotedef_6">
      6. Hidden descriptor caches are omitted.
    </li>
  
    <li class="footnote" id="_footnotedef_7">
      7. This also applies to real mode, where the 8086 behavior is emulated by updating the base value with the segment address times 16, instead of looking up a descriptor table. Other values, such as the limit are constant and are set to initial values, in order to replicate 8086 behavior. This means they can be changed by switching to protected mode, loading the segment registers with new descriptors, and switching back to real mode. This is what unreal mode is.
    </li>
  
    <li class="footnote" id="_footnotedef_8">
      8. Gate DPL is not checked     if interrupt not caused by <code>int</code> instruction.
    </li>
  
    <li class="footnote" id="_footnotedef_9">
      9. Where <em>n</em> is the target CPL.
    </li>
  
    <li class="footnote" id="_footnotedef_10">
      10. This terminology was introduced with the 386. The 286 manual differentiates between restartable (faults and traps) and non-restartable exceptions (aborts).
    </li>
  
    <li class="footnote" id="_footnotedef_11">
      11. This is not a "protection violation", so would be   considered benign, according to the 286 manual.
    </li>
  
    <li class="footnote" id="_footnotedef_12">
      12. Debug features in the 386 and later may dispatch a fault, rather   than a trap, as is the case for exceptions caused by the trap flag.
    </li>
  
    <li class="footnote" id="_footnotedef_13">
      13. Always zero.
    </li>
  
    <li class="footnote" id="_footnotedef_14">
      14. 486 and later never dispatch this exception.
    </li>
  
    <li class="footnote" id="_footnotedef_15">
      15. May not be restartable on 386 and 486 if it happens when   dispatching an interrupt.
    </li>
  
    <li class="footnote" id="_footnotedef_16">
      16. With the 286, a segment limit overrun during a string   operation, a general protection fault during a coprocessor segment overrun,   and writing into a read-only segment through <code>adc</code>, <code>sbb</code>, <code>rcl</code>, or <code>rcr</code>   are not restartable.   On later processors, a general protection fault is always restartable, but if   it was caused while dispatching an interrupt, the interrupt may be lost.
    </li>
  
    <li class="footnote" id="_footnotedef_17">
      17. Motherboards may wire this interrupt somewhere   else.   XT-class PCs wired the FPU error pin to NMI.   The IBM AT and most AT-class machines wire this to IRQ13, with the BIOS then   redirecting it to NMI for compatibility.   Some manufacturers wire it to NMI or to interrupt 16, causing compatibility   problems.   CPUs with integrated FPUs (i.e. 486 and later) have a flag on whether to   route the instruction externally through the motherboard, or whether to use   interrupt 16 internally.
    </li>
  
    <li class="footnote" id="_footnotedef_18">
      18. The 286 manual does not use this terminology. Instead, it differentiates between protection violation and other (instead of contributory and benign).
    </li>
  
    <li class="footnote" id="_footnotedef_19">
      19. Hidden descriptor caches are omitted.
    </li>
  
    <li class="footnote" id="_footnotedef_20">
      20. Word or dword I/O to unaligned ports may cross a byte boundary, meaning two bytes need to be loaded. Thus it is recommended to have an extra byte after the highest I/O port that is accessed, with numerical value 255.
    </li>
  
    <li class="footnote" id="_footnotedef_21">
      21. Hidden descriptor caches are omitted.
    </li>
  
    <li class="footnote" id="_footnotedef_22">
      22. Always zero.
    </li>
  
    <li class="footnote" id="_footnotedef_23">
      23. Hidden descriptor caches are omitted.
    </li>
  
    <li class="footnote" id="_footnotedef_24">
      24. The original Pentium and late 486 only has the first two standard functions.
    </li>
  
    <li class="footnote" id="_footnotedef_25">
      25. Not on AMD.
    </li>
  
    <li class="footnote" id="_footnotedef_26">
      26. Intel only.
    </li>
  
  </ul>

</article>

            <footer>
                &copy; 2021 osdev.wiki contributors.
                All contents released under the Creative Commons Zero license.
                Search provided by
                <a href="https://stork-search.net/">Stork</a> under the
                Apache-2.0 license.
                <a href="https://github.com/lukflug/wiki/tree/main/">Source code</a>.
            </footer>
        </div>
        <script src="https://files.stork-search.net/releases/v1.4.0/stork.js" integrity="sha512-aWKhPNaS3Dw47qzN1e1oxmqW0LofAvNpvrLFPb+DISgrfQPdkn5bmqaVnPyyPK5o69v9z1alQhU9yEvUcgp9Cg==" crossorigin="anonymous"></script>
        <script src="../_/static/search.js"></script>
    </body>
</html>
<!-- vim: set sw=4 et : -->
